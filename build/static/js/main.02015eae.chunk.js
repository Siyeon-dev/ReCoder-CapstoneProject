(this.webpackJsonprecoder_mobile_test=this.webpackJsonprecoder_mobile_test||[]).push([[0],{21:function(e,r,n){},81:function(e,r,n){"use strict";n.r(r);var t=n(0),o=n(6),a=n.n(o),i=n(16),s=n(5),d=(n(56),n(21),n(2));var c=function(){return Object(d.jsx)("div",{children:Object(d.jsx)("header",{className:"HeaderTitle",children:Object(d.jsx)("span",{children:"Re:coder"})})})},l=n(11),u=n(110),f=n(27),v=n.n(f),m=n(109),g=function(){var e=Object(t.useState)(),r=Object(l.a)(e,2),n=r[0],o=r[1],a=Object(t.useState)(),i=Object(l.a)(a,2),f=i[0],g=i[1],p=Object(t.useState)(),b=Object(l.a)(p,2),h=(b[0],b[1]),w=Object(u.a)(),S=Object(l.a)(w,3),y=(S[0],S[1]),k=S[2],T=Object(s.e)();Object(t.useEffect)((function(){k("s_email"),k("s_name"),k("isLogin")}),[]);return Object(d.jsxs)("div",{children:[Object(d.jsx)(c,{}),Object(d.jsxs)("div",{className:"MainBox",children:[Object(d.jsx)("span",{className:"BoxTextTitle",children:"\uc628\ub77c\uc778 \ucf54\ub529 \uc2dc\ud5d8 \ud50c\ub7ab\ud3fc Re:Coder \uc785\ub2c8\ub2e4"}),Object(d.jsx)("span",{className:"BoxTextConnect",children:"\uc628\ub77c\uc778 \uc2dc\ud5d8 \uac10\ub3c5\uc744 \uc704\ud574 \uce74\uba54\ub77c \uc0ac\uc6a9 \uad8c\ud55c \ud5c8\uc6a9\uc774 \ud544\uc694\ud569\ub2c8\ub2e4."}),Object(d.jsx)("div",{className:"MainSubBox",children:Object(d.jsx)("span",{className:"SubBoxText",children:"\uc6d0\ud65c\ud55c \uc2dc\ud5d8 \uc751\uc2dc\ub97c \uc704\ud558\uc5ec ID\uc640 PW\ub97c \uc785\ub825 \ud6c4 \ub85c\uadf8\uc778 \ud574 \uc8fc\uc138\uc694."})}),Object(d.jsxs)("div",{className:"LoginBox",children:[Object(d.jsxs)("span",{className:"BoxTextCode",children:[Object(d.jsx)("span",{style:{color:"red"},children:"\u273b"})," \ub85c\uadf8\uc778"]}),Object(d.jsxs)("div",{className:"InputBox",children:[Object(d.jsx)(m.a,{id:"userId",variant:"outlined",size:"small",label:"ID",style:{width:"100%",margin:"10px 0px"},onChange:function(e){return o(e.target.value)}}),Object(d.jsx)(m.a,{id:"userPw",variant:"outlined",size:"small",label:"PW",style:{width:"100%"},type:"password",onChange:function(e){return g(e.target.value)}})]})]}),Object(d.jsx)("div",{children:Object(d.jsx)("button",{className:"MainButton",onClick:function(){return function(e){var r={s_email:n,s_password:f};h(r),console.log(r),v.a.post("http://3.89.30.234:3000/login",r).then((function(e){localStorage.setItem("token",e.data.token);var n=e.data.accessToken;v.a.defaults.headers.common.Authorization="Bearer ".concat(n),console.log(e.data),"success"==e.data.login?(alert("\ub85c\uadf8\uc778 \ub418\uc5c8\uc2b5\ub2c8\ub2e4"),y("s_email",r.s_email),y("s_name",e.data.s_name),y("isLogin",!0),T.push("/Guide")):(alert("\ub85c\uadf8\uc778\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4\n\uc544\uc774\ub514 \ub610\ub294 \ube44\ubc00\ubc88\ud638\ub97c \ud655\uc778\ud558\uc5ec \uc8fc\uc138\uc694"),T.push("/"))})).catch((function(e){console.log(e.res),localStorage.removeItem("token")}))}()},children:"\ub85c\uadf8\uc778"})})]})]})},p=n.p+"static/media/sample1.1a0bc72c.png",b=n.p+"static/media/sample2.f48f191e.png",h=n.p+"static/media/sample3.a030fbbb.png",w=function(){var e=Object(t.useState)(),r=Object(l.a)(e,2),n=(r[0],r[1]),o=Object(t.useState)(),a=Object(l.a)(o,2),s=a[0],f=a[1],v=Object(t.useState)(),m=Object(l.a)(v,2),g=(m[0],m[1],Object(u.a)(["token"])),w=Object(l.a)(g,3),S=w[0];w[1],w[2];return Object(t.useEffect)((function(){console.log(S),n(S.s_email),f(S.s_name)})),Object(d.jsxs)("div",{children:[Object(d.jsx)(c,{}),Object(d.jsxs)("span",{children:[s,"\ub2d8 \ud658\uc601\ud569\ub2c8\ub2e4!"]}),Object(d.jsxs)("div",{className:"MainBox",children:[Object(d.jsx)("span",{className:"GuideTextTitle",children:"Re:coder \ubaa8\ubc14\uc77c \ucd2c\uc601 \ud654\uba74\uc785\ub2c8\ub2e4."}),Object(d.jsx)("div",{className:"GuideBox",children:Object(d.jsx)("span",{className:"GuideStartText",children:"PC \uc2dc\ud5d8 \uc900\ube44\ub97c \uc704\ud574 \uc544\ub798 \uc548\ub0b4\ub97c \uc798 \uc77d\uace0 \ub530\ub77c\uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4."})}),Object(d.jsx)("div",{className:"GuideBox",children:Object(d.jsx)("span",{className:"GuideCameraText",children:"\ucd2c\uc601 \uc2dc\uc791\uc744 \ud074\ub9ad\ud558\uba74 \uce74\uba54\ub77c\uc640 \ub9c8\uc774\ud06c\uc758 \uc811\uadfc \ud5c8\uc6a9 \ud31d\uc5c5 \ucc3d\uc774 \ub098\uc635\ub2c8\ub2e4. \ud574\ub2f9 \ud31d\uc5c5 \ucc3d\uc5d0\uc11c [\ud5c8\uc6a9] \uc744 \uc120\ud0dd\ud558\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4."})}),Object(d.jsxs)("div",{className:"GuideAllowBox",children:[Object(d.jsx)("span",{className:"GuideAllowTitle",children:"[\uce74\uba54\ub77c, \ub9c8\uc774\ud06c \uad8c\ud55c \ud5c8\uc6a9 \uc548\ub0b4]"}),Object(d.jsx)("div",{className:"GuideImageBox",children:Object(d.jsx)("img",{src:p})})]}),Object(d.jsxs)("div",{className:"GuideAllowBox",children:[Object(d.jsx)("span",{className:"GuideAllowTitle",children:"[\uc62c\ubc14\ub978 \ucd2c\uc601 \ubc29\ubc95]"}),Object(d.jsx)("div",{className:"GuideImageBox",children:Object(d.jsx)("img",{src:b})}),Object(d.jsx)("span",{className:"GuideAllowText",children:"\uac70\uce58\ub300\ub098 \ubb3c\uac74 \ub4f1\uc744 \uc0ac\uc6a9\ud558\uc5ec \ucd5c\uc18c 1m \uc815\ub3c4 \ub5a8\uc5b4\uc9c4 \uacf3\uc5d0 \ud734\ub300\ud3f0\uc744 \uace0\uc815\uc2dc\ud0b5\ub2c8\ub2e4."}),Object(d.jsx)("div",{className:"GuideImageBox",children:Object(d.jsx)("img",{src:h})}),Object(d.jsx)("span",{className:"GuideAllowText",children:"\uc5bc\uad74\uacfc \uc190, \ubaa8\ub2c8\ud130 \ud654\uba74\uc774 \ub3d9\uc2dc\uc5d0 \ub098\uc624\ub3c4\ub85d \uce74\uba54\ub77c \ud654\uba74\uc744 \uc870\uc815\ud558\uc138\uc694."})]}),Object(d.jsx)("div",{children:Object(d.jsx)(i.a,{children:Object(d.jsx)(i.b,{to:"/Camera",children:Object(d.jsx)("button",{className:"GuideButton",children:"\ucd2c\uc601 \uc2dc\uc791"})})})})]})]})},S=n(13),y=n(31),k=n(47),T=n.n(k);C.sessions={},C.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),r=33;return window.navigator.userAgent.match("Linux")&&(r=35),e>=26&&e<=r||C.extension.isInstalled()}return!0};var j={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var r=window.setTimeout((function(){var r=new Error("NavigatorUserMediaError");return r.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(r)}),1e3);this.cache[r]=e,window.postMessage({type:"janusGetScreen",id:r},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(r){if(r.origin==window.location.origin)if("janusGotScreen"==r.data.type&&e[r.data.id]){var n=e[r.data.id];if(delete e[r.data.id],""===r.data.sourceId){var t=new Error("NavigatorUserMediaError");t.name="You cancelled the request for permission, giving up...",n(t)}else n(null,r.data.sourceId)}else"janusGetScreenPending"==r.data.type&&(console.log("clearing ",r.data.id),window.clearTimeout(r.data.id))}))}};function C(e){if((e=e||{}).success="function"==typeof e.success?e.success:C.noop,e.error="function"==typeof e.error?e.error:C.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:C.noop,!C.initDone)return e.error("Library not initialized"),{};if(!C.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(C.log("Library initialized: "+C.initDone),!e.server)return e.error("Invalid server url"),{};var r=!1,n=null,t={},o=null,a=null,i=0,s=e.server;C.isArray(s)?(C.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,a=e.server,C.debug(a)):0===s.indexOf("ws")?(r=!0,C.log("Using WebSockets to contact Janus: "+s)):(r=!1,C.log("Using REST API to contact Janus: "+s));var d=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],c=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var v=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(v=e.max_poll_events),v<1&&(v=1);var m=null;void 0!==e.token&&null!==e.token&&(m=e.token);var g=null;void 0!==e.apisecret&&null!==e.apisecret&&(g=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var p=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(p=e.keepAlivePeriod),isNaN(p)&&(p=25e3);var b=6e4;function h(e){var r={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(r.high=e.high),e.medium&&(r.medium=e.medium),e.low&&(r.low=e.low)),r}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(b=e.longPollTimeout),isNaN(b)&&(b=6e4);var w=!1,y=null,k={},T=this,j=0,A={};function D(){if(null!=y)if(C.debug("Long poll..."),w){var r=s+"/"+y+"?rid="+(new Date).getTime();v&&(r=r+"&maxev="+v),m&&(r=r+"&token="+encodeURIComponent(m)),g&&(r=r+"&apisecret="+encodeURIComponent(g)),C.httpAPICall(r,{verb:"GET",withCredentials:f,success:x,timeout:b,error:function(r,n){if(C.error(r+":",n),++j>3)return w=!1,void e.error("Lost connection to the server (is it down?)");D()}})}else C.warn("Is the server down? (connected=false)")}function x(e,t){if(j=0,r||void 0===y||null===y||!0===t||D(),r||!C.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){if(!(d=e.sender))return void C.warn("Missing sender...");if(!(l=k[d]))return void C.debug("This handle is not attached to this session");var o=e.candidate;C.debug("Got a trickled candidate on session "+y),C.debug(o);var a=l.webrtcStuff;a.pc&&a.remoteSdp?(C.debug("Adding remote candidate:",o),o&&!0!==o.completed?a.pc.addIceCandidate(o):a.pc.addIceCandidate(C.endOfCandidates)):(C.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),a.candidates||(a.candidates=[]),a.candidates.push(o),C.debug(a.candidates))}else{if("webrtcup"===e.janus)return C.debug("Got a webrtcup event on session "+y),C.debug(e),(d=e.sender)?(l=k[d])?void l.webrtcState(!0):void C.debug("This handle is not attached to this session"):void C.warn("Missing sender...");if("hangup"===e.janus){if(C.debug("Got a hangup event on session "+y),C.debug(e),!(d=e.sender))return void C.warn("Missing sender...");if(!(l=k[d]))return void C.debug("This handle is not attached to this session");l.webrtcState(!1,e.reason),l.hangup()}else if("detached"===e.janus){if(C.debug("Got a detached event on session "+y),C.debug(e),!(d=e.sender))return void C.warn("Missing sender...");if(!(l=k[d]))return;l.detached=!0,l.ondetached(),l.detach()}else if("media"===e.janus){if(C.debug("Got a media event on session "+y),C.debug(e),!(d=e.sender))return void C.warn("Missing sender...");if(!(l=k[d]))return void C.debug("This handle is not attached to this session");l.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){if(C.debug("Got a slowlink event on session "+y),C.debug(e),!(d=e.sender))return void C.warn("Missing sender...");if(!(l=k[d]))return void C.debug("This handle is not attached to this session");l.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){var i,s;if(C.error("Ooops: "+e.error.code+" "+e.error.reason),C.debug(e),i=e.transaction)(s=A[i])&&s(e),delete A[i];return}if("event"===e.janus){var d;if(C.debug("Got a plugin event on session "+y),C.debug(e),!(d=e.sender))return void C.warn("Missing sender...");var c=e.plugindata;if(!c)return void C.warn("Missing plugindata...");C.debug("  -- Event is coming from "+d+" ("+c.plugin+")");var l,u=c.data;if(C.debug(u),!(l=k[d]))return void C.warn("This handle is not attached to this session");var f=e.jsep;f&&(C.debug("Handling SDP as well..."),C.debug(f));var v=l.onmessage;v?(C.debug("Notifying application..."),v(u,f)):C.debug("No provided notification callback")}else{if("timeout"===e.janus)return C.error("Timeout on session "+y),C.debug(e),void(r&&n.close(3504,"Gateway timeout"));C.warn("Unknown message/event  '"+e.janus+"' on session "+y),C.debug(e)}}}else C.debug("Got a success on session "+y),C.debug(e),(i=e.transaction)&&((s=A[i])&&s(e),delete A[i]);else C.debug("Got an ack on session "+y),C.debug(e),(i=e.transaction)&&((s=A[i])&&s(e),delete A[i]);else C.debug("Got info on the Janus instance"),C.debug(e),(i=e.transaction)&&((s=A[i])&&s(e),delete A[i]);else C.vdebug("Got a keepalive on session "+y);else for(var m=0;m<e.length;m++)x(e[m],!0)}function O(){if(s&&r&&w){o=setTimeout(O,p);var e={janus:"keepalive",session_id:y,transaction:C.randomString(12)};m&&(e.token=m),g&&(e.apisecret=g),n.send(JSON.stringify(e))}}function R(d){var c=C.randomString(12),l={janus:"create",transaction:c};if(d.reconnect&&(w=!1,l.janus="claim",l.session_id=y,n&&(n.onopen=null,n.onerror=null,n.onclose=null,o&&(clearTimeout(o),o=null))),m&&(l.token=m),g&&(l.apisecret=g),!s&&C.isArray(a)&&(0===(s=a[i]).indexOf("ws")?(r=!0,C.log("Server #"+(i+1)+": trying WebSockets to contact Janus ("+s+")")):(r=!1,C.log("Server #"+(i+1)+": trying REST API to contact Janus ("+s+")"))),r)for(var u in n=C.newWebSocket(s,"janus-protocol"),t={error:function(){if(C.error("Error connecting to the Janus WebSockets server... "+s),C.isArray(a)&&!d.reconnect)return++i===a.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){R(d)}),200));d.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){A[c]=function(e){if(C.debug(e),"success"!==e.janus)return C.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);o=setTimeout(O,p),w=!0,y=e.session_id?e.session_id:e.data.id,d.reconnect?C.log("Claimed session: "+y):C.log("Created session: "+y),C.sessions[y]=T,d.success()},n.send(JSON.stringify(l))},message:function(e){x(JSON.parse(e.data))},close:function(){s&&w&&(w=!1,e.error("Lost connection to the server (is it down?)"))}})n.addEventListener(u,t[u]);else C.httpAPICall(s,{verb:"POST",withCredentials:f,body:l,success:function(e){if(C.debug(e),"success"!==e.janus)return C.error("Ooops: "+e.error.code+" "+e.error.reason),void d.error(e.error.reason);w=!0,y=e.session_id?e.session_id:e.data.id,d.reconnect?C.log("Claimed session: "+y):C.log("Created session: "+y),C.sessions[y]=T,D(),d.success()},error:function(e,r){if(C.error(e+":",r),C.isArray(a)&&!d.reconnect)return++i===a.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){R(d)}),200));""===r?d.error(e+": Is the server down?"):d.error(e+": "+r)}})}function I(e,t){if((t=t||{}).success="function"==typeof t.success?t.success:C.noop,t.error="function"==typeof t.error?t.error:C.noop,!w)return C.warn("Is the server down? (connected=false)"),void t.error("Is the server down? (connected=false)");var o=k[e];if(!o||!o.webrtcStuff)return C.warn("Invalid handle"),void t.error("Invalid handle");var a=t.message,i=t.jsep,d=C.randomString(12),c={janus:"message",body:a,transaction:d};if(o.token&&(c.token=o.token),g&&(c.apisecret=g),i&&(c.jsep={type:i.type,sdp:i.sdp},i.e2ee&&(c.jsep.e2ee=!0),"hml"!==i.rid_order&&"lmh"!==i.rid_order||(c.jsep.rid_order=i.rid_order)),C.debug("Sending message to plugin (handle="+e+"):"),C.debug(c),r)return c.session_id=y,c.handle_id=e,A[d]=function(e){if(C.debug("Message sent!"),C.debug(e),"success"===e.janus){var r=e.plugindata;if(!r)return C.warn("Request succeeded, but missing plugindata..."),void t.success();C.log("Synchronous transaction successful ("+r.plugin+")");var n=r.data;return C.debug(n),void t.success(n)}"ack"===e.janus?t.success():e.error?(C.error("Ooops: "+e.error.code+" "+e.error.reason),t.error(e.error.code+" "+e.error.reason)):(C.error("Unknown error"),t.error("Unknown error"))},void n.send(JSON.stringify(c));C.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:f,body:c,success:function(e){if(C.debug("Message sent!"),C.debug(e),"success"===e.janus){var r=e.plugindata;if(!r)return C.warn("Request succeeded, but missing plugindata..."),void t.success();C.log("Synchronous transaction successful ("+r.plugin+")");var n=r.data;return C.debug(n),void t.success(n)}"ack"===e.janus?t.success():e.error?(C.error("Ooops: "+e.error.code+" "+e.error.reason),t.error(e.error.code+" "+e.error.reason)):(C.error("Unknown error"),t.error("Unknown error"))},error:function(e,r){C.error(e+":",r),t.error(e+": "+r)}})}function P(e,t){if(w){var o=k[e];if(o&&o.webrtcStuff){var a={janus:"trickle",candidate:t,transaction:C.randomString(12)};if(o.token&&(a.token=o.token),g&&(a.apisecret=g),C.vdebug("Sending trickle candidate (handle="+e+"):"),C.vdebug(a),r)return a.session_id=y,a.handle_id=e,void n.send(JSON.stringify(a));C.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:f,body:a,success:function(e){C.vdebug("Candidate sent!"),C.vdebug(e),"ack"===e.janus||C.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,r){C.error(e+":",r)}})}else C.warn("Invalid handle")}else C.warn("Is the server down? (connected=false)")}function V(e,r,n,t,o){var a=k[e];if(a&&a.webrtcStuff){var i=a.webrtcStuff;if(i.pc){var s=function(e){C.log("Received state change on data channel:",e);var r=e.target.label,n=e.target.protocol,t=i.dataChannel[r]?i.dataChannel[r].readyState:"null";if(C.log("State change on <"+r+"> data channel: "+t),"open"===t){if(i.dataChannel[r].pending&&i.dataChannel[r].pending.length>0){C.log("Sending pending messages on <"+r+">:",i.dataChannel[r].pending.length);var o,s=Object(S.a)(i.dataChannel[r].pending);try{for(s.s();!(o=s.n()).done;){var d=o.value;C.log("Sending data on data channel <"+r+">"),C.debug(d),i.dataChannel[r].send(d)}}catch(c){s.e(c)}finally{s.f()}i.dataChannel[r].pending=[]}a.ondataopen(r,n)}};if(t)i.dataChannel[r]=t;else{var d={ordered:!0};n&&(d.protocol=n),i.dataChannel[r]=i.pc.createDataChannel(r,d)}i.dataChannel[r].onmessage=function(e){C.log("Received message on data channel:",e);var r=e.target.label;a.ondata(e.data,r)},i.dataChannel[r].onopen=s,i.dataChannel[r].onclose=s,i.dataChannel[r].onerror=function(e){C.error("Got error on data channel:",e)},i.dataChannel[r].pending=[],o&&i.dataChannel[r].pending.push(o)}else C.warn("Invalid PeerConnection")}else C.warn("Invalid handle")}function M(e,r){(r=r||{}).success="function"==typeof r.success?r.success:C.noop,r.error="function"==typeof r.error?r.error:C.noop;var n=k[e];if(!n||!n.webrtcStuff)return C.warn("Invalid handle"),void r.error("Invalid handle");var t=n.webrtcStuff,o=r.text||r.data;if(!o)return C.warn("Invalid data"),void r.error("Invalid data");var a=r.label?r.label:C.dataChanDefaultLabel;return t.dataChannel[a]?"open"!==t.dataChannel[a].readyState?(t.dataChannel[a].pending.push(o),void r.success()):(C.log("Sending data on data channel <"+a+">"),C.debug(o),t.dataChannel[a].send(o),void r.success()):(V(e,a,r.protocol,!1,o,r.protocol),void r.success())}function E(e,r){(r=r||{}).success="function"==typeof r.success?r.success:C.noop,r.error="function"==typeof r.error?r.error:C.noop;var n=k[e];if(!n||!n.webrtcStuff)return C.warn("Invalid handle"),void r.error("Invalid handle");var t=n.webrtcStuff;if(!t.dtmfSender){if(t.pc){var o=t.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!o)return C.warn("Invalid DTMF configuration (no audio track)"),void r.error("Invalid DTMF configuration (no audio track)");t.dtmfSender=o.dtmf,t.dtmfSender&&(C.log("Created DTMF Sender"),t.dtmfSender.ontonechange=function(e){C.debug("Sent DTMF tone: "+e.tone)})}if(!t.dtmfSender)return C.warn("Invalid DTMF configuration"),void r.error("Invalid DTMF configuration")}var a=r.dtmf;if(!a)return C.warn("Invalid DTMF parameters"),void r.error("Invalid DTMF parameters");var i=a.tones;if(!i)return C.warn("Invalid DTMF string"),void r.error("Invalid DTMF string");var s="number"===typeof a.duration?a.duration:500,d="number"===typeof a.gap?a.gap:50;C.debug("Sending DTMF string "+i+" (duration "+s+"ms, gap "+d+"ms)"),t.dtmfSender.insertDTMF(i,s,d),r.success()}function N(e,t){(t=t||{}).success="function"==typeof t.success?t.success:C.noop,t.error="function"==typeof t.error?t.error:C.noop;var o=!0===t.noRequest;C.log("Destroying handle "+e+" (only-locally="+o+")"),q(e);var a=k[e];if(!a||a.detached)return delete k[e],void t.success();if(o)return delete k[e],void t.success();if(!w)return C.warn("Is the server down? (connected=false)"),void t.error("Is the server down? (connected=false)");var i={janus:"detach",transaction:C.randomString(12)};if(a.token&&(i.token=a.token),g&&(i.apisecret=g),r)return i.session_id=y,i.handle_id=e,n.send(JSON.stringify(i)),delete k[e],void t.success();C.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:f,body:i,success:function(r){C.log("Destroyed handle:"),C.debug(r),"success"!==r.janus&&C.error("Ooops: "+r.error.code+" "+r.error.reason),delete k[e],t.success()},error:function(r,n){C.error(r+":",n),delete k[e],t.success()}})}function B(e,r,n,t,o){var a=k[e];if(!a||!a.webrtcStuff)return C.warn("Invalid handle"),t.stream||C.stopAllTracks(o),void t.error("Invalid handle");var i=a.webrtcStuff;C.debug("streamsDone:",o),o&&(C.debug("  -- Audio tracks:",o.getAudioTracks()),C.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(i.myStream&&n.update&&!i.streamExternal){if((!n.update&&z(n)||n.update&&(n.addAudio||n.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(i.myStream.addTrack(o.getAudioTracks()[0]),C.unifiedPlan){C.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var f=null;if((g=i.pc.getTransceivers())&&g.length>0){var v,m=Object(S.a)(g);try{for(m.s();!(v=m.n()).done;){if((y=v.value).sender&&y.sender.track&&"audio"===y.sender.track.kind||y.receiver&&y.receiver.track&&"audio"===y.receiver.track.kind){f=y;break}}}catch(x){m.e(x)}finally{m.f()}}f&&f.sender?f.sender.replaceTrack(o.getAudioTracks()[0]):i.pc.addTrack(o.getAudioTracks()[0],o)}else C.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),i.pc.addTrack(o.getAudioTracks()[0],o);if((!n.update&&Y(n)||n.update&&(n.addVideo||n.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(i.myStream.addTrack(o.getVideoTracks()[0]),C.unifiedPlan){C.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var g,p=null;if((g=i.pc.getTransceivers())&&g.length>0){var b,w=Object(S.a)(g);try{for(w.s();!(b=w.n()).done;){var y;if((y=b.value).sender&&y.sender.track&&"video"===y.sender.track.kind||y.receiver&&y.receiver.track&&"video"===y.receiver.track.kind){p=y;break}}}catch(x){w.e(x)}finally{w.f()}}p&&p.sender?p.sender.replaceTrack(o.getVideoTracks()[0]):i.pc.addTrack(o.getVideoTracks()[0],o)}else C.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),i.pc.addTrack(o.getVideoTracks()[0],o)}else i.myStream=o,s=!0;if(!i.pc){var T={iceServers:d,iceTransportPolicy:c,bundlePolicy:l};"chrome"===C.webRTCAdapter.browserDetails.browser&&(T.sdpSemantics=C.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var j={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&j.optional.push({googIPv6:!0}),t.rtcConstraints&&"object"===typeof t.rtcConstraints)for(var A in C.debug("Adding custom PeerConnection constraints:",t.rtcConstraints),t.rtcConstraints)j.optional.push(t.rtcConstraints[A]);"edge"===C.webRTCAdapter.browserDetails.browser&&(T.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(t.senderTransforms||t.receiverTransforms)&&(i.senderTransforms=t.senderTransforms,i.receiverTransforms=t.receiverTransforms,T.forceEncodedAudioInsertableStreams=!0,T.forceEncodedVideoInsertableStreams=!0,T.encodedInsertableStreams=!0),C.log("Creating PeerConnection"),C.debug(j),i.pc=new RTCPeerConnection(T,j),C.debug(i.pc),i.pc.getStats&&(i.volume={},i.bitrate.value="0 kbits/sec"),C.log("Preparing local SDP and gathering candidates (trickle="+i.trickle+")"),i.pc.oniceconnectionstatechange=function(e){i.pc&&a.iceState(i.pc.iceConnectionState)},i.pc.onicecandidate=function(r){if(!r.candidate||"edge"===C.webRTCAdapter.browserDetails.browser&&r.candidate.candidate.indexOf("endOfCandidates")>0)C.log("End of candidates."),i.iceDone=!0,!0===i.trickle?P(e,{completed:!0}):function(e,r){(r=r||{}).success="function"==typeof r.success?r.success:C.noop,r.error="function"==typeof r.error?r.error:C.noop;var n=k[e];if(!n||!n.webrtcStuff)return void C.warn("Invalid handle, not sending anything");var t=n.webrtcStuff;if(C.log("Sending offer/answer SDP..."),!t.mySdp)return void C.warn("Local SDP instance is invalid, not sending anything...");t.mySdp={type:t.pc.localDescription.type,sdp:t.pc.localDescription.sdp},!1===t.trickle&&(t.mySdp.trickle=!1);C.debug(r),t.sdpSent=!0,r.success(t.mySdp)}(e,t);else{var n={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===i.trickle&&P(e,n)}},i.pc.ontrack=function(e){if(C.log("Handling Remote Track"),C.debug(e),e.streams&&(i.remoteStream=e.streams[0],a.onremotestream(i.remoteStream),!e.track.onended)){if(i.receiverTransforms){var r=null;RTCRtpSender.prototype.createEncodedStreams?r=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&i.receiverTransforms.audio?r=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&i.receiverTransforms.video&&(r=e.receiver.createEncodedVideoStreams())),r&&(console.log(r),r.readableStream&&r.writableStream?r.readableStream.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(r.writableStream):r.readable&&r.writable&&r.readable.pipeThrough(i.receiverTransforms[e.track.kind]).pipeTo(r.writable))}var n=null;C.log("Adding onended callback to track:",e.track),e.track.onended=function(e){C.log("Remote track removed:",e),i.remoteStream&&(clearTimeout(n),i.remoteStream.removeTrack(e.target),a.onremotestream(i.remoteStream))},e.track.onmute=function(e){C.log("Remote track muted:",e),i.remoteStream&&null==n&&(n=setTimeout((function(){C.log("Removing remote track"),i.remoteStream&&(i.remoteStream.removeTrack(e.target),a.onremotestream(i.remoteStream)),n=null}),2520))},e.track.onunmute=function(e){if(C.log("Remote track flowing again:",e),null!=n)clearTimeout(n),n=null;else try{i.remoteStream.addTrack(e.target),a.onremotestream(i.remoteStream)}catch(r){C.error(r)}}}}}if(s&&o){C.log("Adding local stream");var D=!0===t.simulcast2;o.getTracks().forEach((function(e){C.log("Adding local track:",e);var r=null;if(D&&"audio"!==e.kind){C.log("Enabling rid-based simulcasting:",e);var n=h(t.simulcastMaxBitrates),a=i.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:t.sendEncodings||[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}]});a&&(r=a.sender)}else r=i.pc.addTrack(e,o);if(r&&i.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=r.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===r.track.kind&&i.senderTransforms.audio?s=r.createEncodedAudioStreams():"video"===r.track.kind&&i.senderTransforms.video&&(s=r.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(i.senderTransforms[r.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(i.senderTransforms[r.track.kind]).pipeTo(s.writable))}}))}(function(e){if(C.debug("isDataEnabled:",e),"edge"===C.webRTCAdapter.browserDetails.browser)return C.warn("Edge doesn't support data channels yet"),!1;return void 0!==e&&null!==e&&!0===e.data})(n)&&!i.dataChannel[C.dataChanDefaultLabel]&&(C.log("Creating default data channel"),V(e,C.dataChanDefaultLabel,null,!1),i.pc.ondatachannel=function(r){C.log("Data channel created by Janus:",r),V(e,r.channel.label,r.channel.protocol,r.channel)}),i.myStream&&a.onlocalstream(i.myStream),r?i.pc.setRemoteDescription(r).then((function(){if(C.log("Remote description accepted!"),i.remoteSdp=r.sdp,i.candidates&&i.candidates.length>0){for(var o=0;o<i.candidates.length;o++){var a=i.candidates[o];C.debug("Adding remote candidate:",a),a&&!0!==a.completed?i.pc.addIceCandidate(a):i.pc.addIceCandidate(C.endOfCandidates)}i.candidates=[]}!function(e,r,n){(n=n||{}).success="function"==typeof n.success?n.success:C.noop,n.error="function"==typeof n.error?n.error:C.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:C.noop;var t=k[e];if(!t||!t.webrtcStuff)return C.warn("Invalid handle"),void n.error("Invalid handle");var o=t.webrtcStuff,a=!0===n.simulcast;a?C.log("Creating answer (iceDone="+o.iceDone+", simulcast="+a+")"):C.log("Creating answer (iceDone="+o.iceDone+")");var i=null;if(C.unifiedPlan){i={};var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0){var l,u=Object(S.a)(c);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(d||(d=f))}}catch(x){u.e(x)}finally{u.f()}}var v=z(r),m=H(r);if(v||m){if(v&&m){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",C.log("Setting audio transceiver to sendrecv:",s)}catch(j){C.error(j)}}else if(v&&!m)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",C.log("Setting audio transceiver to sendonly:",s))}catch(j){C.error(j)}else if(!v&&m)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",C.log("Setting audio transceiver to recvonly:",s)}catch(j){C.error(j)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),C.log("Adding recvonly audio transceiver:",s)}else if(r.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",C.log("Setting audio transceiver to inactive:",s)}catch(j){C.error(j)}var g=Y(r),p=K(r);if(g||p){if(g&&p){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",C.log("Setting video transceiver to sendrecv:",d)}catch(j){C.error(j)}}else if(g&&!p){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",C.log("Setting video transceiver to sendonly:",d)}catch(j){C.error(j)}}else if(!g&&p)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",C.log("Setting video transceiver to recvonly:",d)}catch(j){C.error(j)}else d=o.pc.addTransceiver("video",{direction:"recvonly"}),C.log("Adding recvonly video transceiver:",d)}else if(r.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",C.log("Setting video transceiver to inactive:",d)}catch(j){C.error(j)}}else i="firefox"===C.webRTCAdapter.browserDetails.browser||"edge"===C.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:H(r),offerToReceiveVideo:K(r)}:{mandatory:{OfferToReceiveAudio:H(r),OfferToReceiveVideo:K(r)}};C.debug(i);var b=Y(r);if(b&&a&&"firefox"===C.webRTCAdapter.browserDetails.browser){C.log("Enabling Simulcasting for Firefox (RID)");var w=o.pc.getSenders()[1];C.log(w);var y=w.getParameters();C.log(y);var T=h(n.simulcastMaxBitrates);w.setParameters({encodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:T.high},{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:T.low,scaleResolutionDownBy:4}]})}o.pc.createAnswer(i).then((function(e){C.debug(e);var r={type:e.type,sdp:e.sdp};n.customizeSdp(r),e.sdp=r.sdp,C.log("Setting local description"),b&&a&&("chrome"===C.webRTCAdapter.browserDetails.browser?C.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==C.webRTCAdapter.browserDetails.browser&&C.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp={type:"answer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(n.error),o.mediaConstraints=i,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),n.success(e)):C.log("Waiting for all candidates...")}),n.error)}(e,n,t)}),t.error):function(e,r,n){(n=n||{}).success="function"==typeof n.success?n.success:C.noop,n.error="function"==typeof n.error?n.error:C.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:C.noop;var t=k[e];if(!t||!t.webrtcStuff)return C.warn("Invalid handle"),void n.error("Invalid handle");var o=t.webrtcStuff,a=!0===n.simulcast;a?C.log("Creating offer (iceDone="+o.iceDone+", simulcast="+a+")"):C.log("Creating offer (iceDone="+o.iceDone+")");var i={};if(C.unifiedPlan){var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0){var l,u=Object(S.a)(c);try{for(u.s();!(l=u.n()).done;){var f=l.value;f.sender&&f.sender.track&&"audio"===f.sender.track.kind||f.receiver&&f.receiver.track&&"audio"===f.receiver.track.kind?s||(s=f):(f.sender&&f.sender.track&&"video"===f.sender.track.kind||f.receiver&&f.receiver.track&&"video"===f.receiver.track.kind)&&(d||(d=f))}}catch(x){u.e(x)}finally{u.f()}}var v=z(r),m=H(r);v||m?v&&m?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",C.log("Setting audio transceiver to sendrecv:",s)):v&&!m?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",C.log("Setting audio transceiver to sendonly:",s)):!v&&m&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",C.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),C.log("Adding recvonly audio transceiver:",s))):r.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",C.log("Setting audio transceiver to inactive:",s));var g=Y(r),p=K(r);g||p?g&&p?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",C.log("Setting video transceiver to sendrecv:",d)):g&&!p?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",C.log("Setting video transceiver to sendonly:",d)):!g&&p&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",C.log("Setting video transceiver to recvonly:",d)):(d=o.pc.addTransceiver("video",{direction:"recvonly"}),C.log("Adding recvonly video transceiver:",d))):r.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",C.log("Setting video transceiver to inactive:",d))}else i.offerToReceiveAudio=H(r),i.offerToReceiveVideo=K(r);!0===n.iceRestart&&(i.iceRestart=!0);C.debug(i);var b=Y(r);if(b&&a&&"firefox"===C.webRTCAdapter.browserDetails.browser){C.log("Enabling Simulcasting for Firefox (RID)");var w=o.pc.getSenders().find((function(e){return"video"===e.track.kind}));if(w){var y=w.getParameters();y||(y={});var T=h(n.simulcastMaxBitrates);y.encodings=n.sendEncodings||[{rid:"h",active:!0,maxBitrate:T.high},{rid:"m",active:!0,maxBitrate:T.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:T.low,scaleResolutionDownBy:4}],w.setParameters(y)}}o.pc.createOffer(i).then((function(e){C.debug(e);var r={type:e.type,sdp:e.sdp};n.customizeSdp(r),e.sdp=r.sdp,C.log("Setting local description"),b&&a&&("chrome"===C.webRTCAdapter.browserDetails.browser||"safari"===C.webRTCAdapter.browserDetails.browser?(C.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var r=e.split("\r\n"),n=!1,t=[-1],o=[-1],a=null,i=null,s=null,d=null,c=-1,l=0;l<r.length;l++){if(f=r[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(t[0]<0)){c=l;break}n=!0}else if(t[0]>-1){c=l;break}}else if(n){if(r[l].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/))return C.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var u=r[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)t[0]=u[1],o[0]=u[2],r.splice(l,1),l--;else{if(t[0]){if((m=r[l].match("a=ssrc:"+t[0]+" cname:(.+)"))&&(a=m[1]),(m=r[l].match("a=ssrc:"+t[0]+" msid:(.+)"))&&(i=m[1]),(m=r[l].match("a=ssrc:"+t[0]+" mslabel:(.+)"))&&(s=m[1]),(m=r[l].match("a=ssrc:"+t[0]+" label:(.+)"))&&(d=m[1]),0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+t[0])){r.splice(l,1),l--;continue}}0!=r[l].length||(r.splice(l,1),l--)}}}if(t[0]<0){c=-1,n=!1;for(l=0;l<r.length;l++){var f;if(f=r[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(t[0]<0)){c=l;break}n=!0}else if(t[0]>-1){c=l;break}}else if(n){if(t[0]<0){var v=r[l].match(/a=ssrc:(\d+)/);if(v){t[0]=v[1],r.splice(l,1),l--;continue}}else{var m;if((m=r[l].match("a=ssrc:"+t[0]+" cname:(.+)"))&&(a=m[1]),(m=r[l].match("a=ssrc:"+t[0]+" msid:(.+)"))&&(i=m[1]),(m=r[l].match("a=ssrc:"+t[0]+" mslabel:(.+)"))&&(s=m[1]),(m=r[l].match("a=ssrc:"+t[0]+" label:(.+)"))&&(d=m[1]),0===r[l].indexOf("a=ssrc:"+o[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+t[0])){r.splice(l,1),l--;continue}}0!==r[l].length||(r.splice(l,1),l--)}}}if(t[0]<0)return C.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=r.length);t[1]=Math.floor(4294967295*Math.random()),t[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(l=0;l<t.length;l++)a&&(r.splice(c,0,"a=ssrc:"+t[l]+" cname:"+a),c++),i&&(r.splice(c,0,"a=ssrc:"+t[l]+" msid:"+i),c++),s&&(r.splice(c,0,"a=ssrc:"+t[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+t[l]+" label:"+d),c++),a&&(r.splice(c,0,"a=ssrc:"+o[l]+" cname:"+a),c++),i&&(r.splice(c,0,"a=ssrc:"+o[l]+" msid:"+i),c++),s&&(r.splice(c,0,"a=ssrc:"+o[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+o[l]+" label:"+d),c++);r.splice(c,0,"a=ssrc-group:FID "+t[2]+" "+o[2]),r.splice(c,0,"a=ssrc-group:FID "+t[1]+" "+o[1]),r.splice(c,0,"a=ssrc-group:FID "+t[0]+" "+o[0]),r.splice(c,0,"a=ssrc-group:SIM "+t[0]+" "+t[1]+" "+t[2]),(e=r.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==C.webRTCAdapter.browserDetails.browser&&C.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp={type:"offer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(n.error),o.mediaConstraints=i,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),n.success(e)):C.log("Waiting for all candidates...")}),n.error)}(e,n,t)}function L(e,r,n){(n=n||{}).success="function"==typeof n.success?n.success:C.noop,n.error="function"==typeof n.error?n.error:W;var t=n.jsep;if(r&&t)return C.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!r&&(!t||!t.type||!t.sdp))return C.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media="object"===typeof n.media&&n.media?n.media:{audio:!0,video:!0};var o=n.media,a=k[e];if(!a||!a.webrtcStuff)return C.warn("Invalid handle"),void n.error("Invalid handle");var i,s=a.webrtcStuff;if(s.trickle=(i=n.trickle,C.debug("isTrickleEnabled:",i),!1!==i),s.pc){if(C.log("Updating existing media session"),o.update=!0,n.stream)n.stream!==s.myStream&&C.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return C.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),z(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return C.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!Y(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Y(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(z(o)&&o.keepAudio&&Y(o)&&o.keepVideo)return a.consentDialog(!1),void B(e,t,o,n,s.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&!s.streamExternal){if(o.removeAudio||o.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var d=s.myStream.getAudioTracks()[0];C.log("Removing audio track:",d),s.myStream.removeTrack(d);try{d.stop()}catch(M){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var c=!0;if(o.replaceAudio&&C.unifiedPlan&&(c=!1),c){var l,u=Object(S.a)(s.pc.getSenders());try{for(u.s();!(l=u.n()).done;){var f=l.value;f&&f.track&&"audio"===f.track.kind&&(C.log("Removing audio sender:",f),s.pc.removeTrack(f))}}catch(E){u.e(E)}finally{u.f()}}}}if(o.removeVideo||o.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var v=s.myStream.getVideoTracks()[0];C.log("Removing video track:",v),s.myStream.removeTrack(v);try{v.stop()}catch(M){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var m=!0;if(o.replaceVideo&&C.unifiedPlan&&(m=!1),m){var g,p=Object(S.a)(s.pc.getSenders());try{for(p.s();!(g=p.n()).done;){var b=g.value;b&&b.track&&"video"===b.track.kind&&(C.log("Removing video sender:",b),s.pc.removeTrack(b))}}catch(E){p.e(E)}finally{p.f()}}}}}if(n.stream){var h=n.stream;return C.log("MediaStream provided by the application"),C.debug(h),o.update&&s.myStream&&s.myStream!==n.stream&&!s.streamExternal&&(C.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,a.consentDialog(!1),void B(e,t,o,n,h)}if(z(o)||Y(o)){if(!C.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var w={mandatory:{},optional:[]};a.consentDialog(!0);var y=z(o);y&&o&&"object"===typeof o.audio&&(y=o.audio);var T=Y(o);if(T&&o){var j=!0===n.simulcast,A=!0===n.simulcast2;if(!j&&!A||t||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===typeof o.video)T=o.video;else{var D=0,x=0;"lowres"===o.video?(x=240,240,D=320):"lowres-16:9"===o.video?(x=180,180,D=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(x=720,720,D=1280):"fhdres"===o.video?(x=1080,1080,D=1920):"4kres"===o.video?(x=2160,2160,D=3840):"stdres"===o.video?(x=480,480,D=640):"stdres-16:9"===o.video?(x=360,360,D=640):(C.log("Default video setting is stdres 4:3"),x=480,480,D=640),C.log("Adding media constraint:",o.video),T={height:{ideal:x},width:{ideal:D}},C.log("Adding video constraint:",T)}else if("screen"===o.video||"window"===o.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return w.video={},o.screenshareFrameRate&&(w.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(w.video.height=o.screenshareHeight),o.screenshareWidth&&(w.video.width=o.screenshareWidth),w.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(w).then((function(r){a.consentDialog(!1),z(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(a){r.addTrack(a.getAudioTracks()[0]),B(e,t,o,n,r)})):B(e,t,o,n,r)}),(function(e){a.consentDialog(!1),n.error(e)}));function O(r,i){a.consentDialog(!1),r?n.error(r):B(e,t,o,n,i)}function R(e,r,n){C.log("Adding media constraint (screen capture)"),C.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),r(null,e)})):r(null,e)})).catch((function(e){a.consentDialog(!1),r(e)}))}if("chrome"===C.webRTCAdapter.browserDetails.browser){var I=C.webRTCAdapter.browserDetails.version,P=33;window.navigator.userAgent.match("Linux")&&(P=35),I>=26&&I<=P?R(w={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(o)&&!o.keepAudio},O):C.extension.getScreen((function(e,r){if(e)return a.consentDialog(!1),n.error(e);(w={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=r,R(w,O,z(o)&&!o.keepAudio)}))}else if("firefox"===C.webRTCAdapter.browserDetails.browser){if(!(C.webRTCAdapter.browserDetails.version>=33)){var V=new Error("NavigatorUserMediaError");return V.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",a.consentDialog(!1),void n.error(V)}R(w={video:{mozMediaSource:o.video,mediaSource:o.video},audio:z(o)&&!o.keepAudio},(function(e,r){if(O(e,r),!e)var n=r.currentTime,t=window.setInterval((function(){r||window.clearInterval(t),r.currentTime==n&&(window.clearInterval(t),r.onended&&r.onended()),n=r.currentTime}),500)}))}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(r){var i=r.some((function(e){return"audioinput"===e.kind})),s=function(e){if(C.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var r=e.video.mandatory;if(r.chromeMediaSource)return"desktop"===r.chromeMediaSource||"screen"===r.chromeMediaSource;if(r.mozMediaSource)return"window"===r.mozMediaSource||"screen"===r.mozMediaSource;if(r.mediaSource)return"window"===r.mediaSource||"screen"===r.mediaSource;return!1}(o)||r.some((function(e){return"videoinput"===e.kind})),d=z(o),c=Y(o),l=function(e){return C.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(o),u=function(e){return C.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(o);if(d||c||l||u){var f=!!d&&i,v=!!c&&s;if(!f&&!v)return a.consentDialog(!1),n.error("No capture device found"),!1;if(!f&&l)return a.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!v&&u)return a.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var m={audio:!(!i||o.keepAudio)&&y,video:!(!s||o.keepVideo)&&T};C.debug("getUserMedia constraints",m),m.audio||m.video?navigator.mediaDevices.getUserMedia(m).then((function(r){a.consentDialog(!1),B(e,t,o,n,r)})).catch((function(e){a.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(a.consentDialog(!1),B(e,t,o,n,h))})).catch((function(e){a.consentDialog(!1),n.error(e)}))}else B(e,t,o,n)}function _(e,r){(r=r||{}).success="function"==typeof r.success?r.success:C.noop,r.error="function"==typeof r.error?r.error:W;var n=r.jsep,t=k[e];if(!t||!t.webrtcStuff)return C.warn("Invalid handle"),void r.error("Invalid handle");var o=t.webrtcStuff;if(n){if(!o.pc)return C.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void r.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(n).then((function(){if(C.log("Remote description accepted!"),o.remoteSdp=n.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var t=o.candidates[e];C.debug("Adding remote candidate:",t),t&&!0!==t.completed?o.pc.addIceCandidate(t):o.pc.addIceCandidate(C.endOfCandidates)}o.candidates=[]}r.success()}),r.error)}else r.error("Invalid JSEP")}function G(e,r){var n=k[e];if(!n||!n.webrtcStuff)return C.warn("Invalid handle"),0;var t=r?"remote":"local",o=n.webrtcStuff;return o.volume[t]||(o.volume[t]={value:0}),!o.pc.getStats||"chrome"!==C.webRTCAdapter.browserDetails.browser&&"safari"!==C.webRTCAdapter.browserDetails.browser?(C.warn("Getting the "+t+" volume unsupported by browser"),0):r&&!o.remoteStream?(C.warn("Remote stream unavailable"),0):r||o.myStream?o.volume[t].timer?o.volume[t].value:(C.log("Starting "+t+" volume monitor"),o.volume[t].timer=setInterval((function(){o.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||(o.volume[t].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(C.warn("Local stream unavailable"),0)}function F(e,r){var n=k[e];if(!n||!n.webrtcStuff)return C.warn("Invalid handle"),!0;var t=n.webrtcStuff;return t.pc?t.myStream?r?t.myStream.getVideoTracks()&&0!==t.myStream.getVideoTracks().length?!t.myStream.getVideoTracks()[0].enabled:(C.warn("No video track"),!0):t.myStream.getAudioTracks()&&0!==t.myStream.getAudioTracks().length?!t.myStream.getAudioTracks()[0].enabled:(C.warn("No audio track"),!0):(C.warn("Invalid local MediaStream"),!0):(C.warn("Invalid PeerConnection"),!0)}function J(e,r,n){var t=k[e];if(!t||!t.webrtcStuff)return C.warn("Invalid handle"),!1;var o=t.webrtcStuff;return o.pc?o.myStream?r?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!n,!0):(C.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!n,!0):(C.warn("No audio track"),!1):(C.warn("Invalid local MediaStream"),!1):(C.warn("Invalid PeerConnection"),!1)}function U(e){var r=k[e];if(!r||!r.webrtcStuff)return C.warn("Invalid handle"),"Invalid handle";var n=r.webrtcStuff;return n.pc?n.pc.getStats?n.bitrate.timer?n.bitrate.value:(C.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var r=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?r=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(r=!0),r)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var t=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"===C.webRTCAdapter.browserDetails.browser&&(t/=1e3);var o=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/t);"safari"===C.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),n.bitrate.value=o+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(C.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function W(e){C.error("WebRTC error:",e)}function q(e,t){C.log("Cleaning WebRTC stuff");var o=k[e];if(o){var a=o.webrtcStuff;if(a){if(!0===t){var i={janus:"hangup",transaction:C.randomString(12)};o.token&&(i.token=o.token),g&&(i.apisecret=g),C.debug("Sending hangup request (handle="+e+"):"),C.debug(i),r?(i.session_id=y,i.handle_id=e,n.send(JSON.stringify(i))):C.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:f,body:i})}a.remoteStream=null,a.volume&&(a.volume.local&&a.volume.local.timer&&clearInterval(a.volume.local.timer),a.volume.remote&&a.volume.remote.timer&&clearInterval(a.volume.remote.timer)),a.volume={},a.bitrate.timer&&clearInterval(a.bitrate.timer),a.bitrate.timer=null,a.bitrate.bsnow=null,a.bitrate.bsbefore=null,a.bitrate.tsnow=null,a.bitrate.tsbefore=null,a.bitrate.value=null,!a.streamExternal&&a.myStream&&(C.log("Stopping local stream tracks"),C.stopAllTracks(a.myStream)),a.streamExternal=!1,a.myStream=null;try{a.pc.close()}catch(d){}a.pc=null,a.candidates=null,a.mySdp=null,a.remoteSdp=null,a.iceDone=!1,a.dataChannel={},a.dtmfSender=null,a.senderTransforms=null,a.receiverTransforms=null}o.oncleanup()}}function z(e){return C.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function H(e){return C.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Y(e){return C.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function K(e){return C.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}R(e),this.getServer=function(){return s},this.isConnected=function(){return w},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:C.noop,e.error="function"==typeof e.error?e.error:C.noop,e.reconnect=!0,R(e)},this.getSessionId=function(){return y},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:C.noop,e.error="function"==typeof e.error?e.error:C.noop,C.log("Getting info on Janus instance"),!w)return C.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var t=C.randomString(12),o={janus:"info",transaction:t};m&&(o.token=m);g&&(o.apisecret=g);if(r)return A[t]=function(r){C.log("Server info:"),C.debug(r),"server_info"!==r.janus&&C.error("Ooops: "+r.error.code+" "+r.error.reason),e.success(r)},void n.send(JSON.stringify(o));C.httpAPICall(s,{verb:"POST",withCredentials:f,body:o,success:function(r){C.log("Server info:"),C.debug(r),"server_info"!==r.janus&&C.error("Ooops: "+r.error.code+" "+r.error.reason),e.success(r)},error:function(r,n){C.error(r+":",n),""===n?e.error(r+": Is the server down?"):e.error(r+": "+n)}})}(e)},this.destroy=function(a){!function(a){(a=a||{}).success="function"==typeof a.success?a.success:C.noop,a.error="function"==typeof a.error?a.error:C.noop;var i=!0===a.unload,d=!0;void 0!==a.notifyDestroyed&&null!==a.notifyDestroyed&&(d=!0===a.notifyDestroyed);var c=!0===a.cleanupHandles;if(C.log("Destroying session "+y+" (unload="+i+")"),!y)return C.warn("No session to destroy"),a.success(),void(d&&e.destroyed());if(c)for(var l in k)N(l,{noRequest:!0});if(!w)return C.warn("Is the server down? (connected=false)"),y=null,void a.success();var u={janus:"destroy",transaction:C.randomString(12)};m&&(u.token=m);g&&(u.apisecret=g);if(i)return r?(n.onclose=null,n.close(),n=null):navigator.sendBeacon(s+"/"+y,JSON.stringify(u)),C.log("Destroyed session:"),y=null,w=!1,a.success(),void(d&&e.destroyed());if(r){u.session_id=y;var v=function(){for(var e in t)n.removeEventListener(e,t[e]);n.removeEventListener("message",p),n.removeEventListener("error",b),o&&clearTimeout(o),n.close()},p=function(r){var n=JSON.parse(r.data);n.session_id==u.session_id&&n.transaction==u.transaction&&(v(),a.success(),d&&e.destroyed())},b=function(r){v(),a.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()};return n.addEventListener("message",p),n.addEventListener("error",b),void(1===n.readyState?n.send(JSON.stringify(u)):b())}C.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:f,body:u,success:function(r){C.log("Destroyed session:"),C.debug(r),y=null,w=!1,"success"!==r.janus&&C.error("Ooops: "+r.error.code+" "+r.error.reason),a.success(),d&&e.destroyed()},error:function(r,n){C.error(r+":",n),y=null,w=!1,a.success(),d&&e.destroyed()}})}(a)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:C.noop,e.error="function"==typeof e.error?e.error:C.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:C.noop,e.iceState="function"==typeof e.iceState?e.iceState:C.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:C.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:C.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:C.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:C.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:C.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:C.noop,e.ondata="function"==typeof e.ondata?e.ondata:C.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:C.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:C.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:C.noop,!w)return C.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var t=e.plugin;if(!t)return C.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,a=e.token?e.token:m,i=C.randomString(12),d={janus:"attach",plugin:t,opaque_id:o,transaction:i};a&&(d.token=a);g&&(d.apisecret=g);if(r)return A[i]=function(r){if(C.debug(r),"success"!==r.janus)return C.error("Ooops: "+r.error.code+" "+r.error.reason),void e.error("Ooops: "+r.error.code+" "+r.error.reason);var n=r.data.id;C.log("Created handle: "+n);var o={session:T,plugin:t,id:n,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return t},getVolume:function(){return G(n,!0)},getRemoteVolume:function(){return G(n,!0)},getLocalVolume:function(){return G(n,!1)},isAudioMuted:function(){return F(n,!1)},muteAudio:function(){return J(n,!1,!0)},unmuteAudio:function(){return J(n,!1,!1)},isVideoMuted:function(){return F(n,!0)},muteVideo:function(){return J(n,!0,!0)},unmuteVideo:function(){return J(n,!0,!1)},getBitrate:function(){return U(n)},send:function(e){I(n,e)},data:function(e){M(n,e)},dtmf:function(e){E(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(n,!0,e)},createAnswer:function(e){L(n,!1,e)},handleRemoteJsep:function(e){_(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(n,!0===e)},detach:function(e){N(n,e)}};k[n]=o,e.success(o)},d.session_id=y,void n.send(JSON.stringify(d));C.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:f,body:d,success:function(r){if(C.debug(r),"success"!==r.janus)return C.error("Ooops: "+r.error.code+" "+r.error.reason),void e.error("Ooops: "+r.error.code+" "+r.error.reason);var n=r.data.id;C.log("Created handle: "+n);var o={session:T,plugin:t,id:n,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return t},getVolume:function(){return G(n,!0)},getRemoteVolume:function(){return G(n,!0)},getLocalVolume:function(){return G(n,!1)},isAudioMuted:function(){return F(n,!1)},muteAudio:function(){return J(n,!1,!0)},unmuteAudio:function(){return J(n,!1,!1)},isVideoMuted:function(){return F(n,!0)},muteVideo:function(){return J(n,!0,!0)},unmuteVideo:function(){return J(n,!0,!1)},getBitrate:function(){return U(n)},send:function(e){I(n,e)},data:function(e){M(n,e)},dtmf:function(e){E(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(n,!0,e)},createAnswer:function(e){L(n,!1,e)},handleRemoteJsep:function(e){_(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){q(n,!0===e)},detach:function(e){N(n,e)}};k[n]=o,e.success(o)},error:function(r,n){C.error(r+":",n),""===n?e.error(r+": Is the server down?"):e.error(r+": "+n)}})}(e)}}C.getDefaultDependencies=function(e){var r=e&&e.fetch||fetch,n=e&&e.Promise||Promise,t=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new t(e,r)},extension:e&&e.extension||j,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||y.a,httpAPICall:function(e,t){var o={method:t.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===t.verb&&(o.headers["Content-Type"]="application/json"),void 0!==t.withCredentials&&(o.credentials=!0===t.withCredentials?"include":t.withCredentials?t.withCredentials:"omit"),t.body&&(o.body=JSON.stringify(t.body));var a=r(e,o).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(t.timeout){var i=new n((function(e,r){var n=setTimeout((function(){return clearTimeout(n),r({message:"Request timed out",timeout:t.timeout})}),t.timeout)}));a=n.race([a,i])}return a.then((function(e){return e.ok?typeof t.success===typeof C.noop?e.json().then((function(e){t.success(e)})).catch((function(r){return n.reject({message:"Failed to parse response body",error:r,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){typeof t.error===typeof C.noop&&t.error(e.message||"<< internal error >>",e)})),a}}},C.useOldDependencies=function(e){var r=e&&e.jQuery||T.a,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new n(e,r)},isArray:function(e){return r.isArray(e)},extension:e&&e.extension||j,webRTCAdapter:e&&e.adapter||y.a,httpAPICall:function(e,n){var t=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},o=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return r.ajax(r.extend(t,o,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){typeof n.success===typeof C.noop&&n.success(e)},error:function(e,r,t){typeof n.error===typeof C.noop&&n.error(r,t)}}))}}},C.noop=function(){},C.dataChanDefaultLabel="JanusDataChannel",C.endOfCandidates=null,C.stopAllTracks=function(e){try{var r,n=e.getTracks(),t=Object(S.a)(n);try{for(t.s();!(r=t.n()).done;){var o=r.value;C.log(o),o&&o.stop()}}catch(a){t.e(a)}finally{t.f()}}catch(i){}},C.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:C.noop,C.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),C.trace=C.noop,C.debug=C.noop,C.vdebug=C.noop,C.log=C.noop,C.warn=C.noop,C.error=C.noop,!0===e.debug||"all"===e.debug)C.trace=console.trace.bind(console),C.debug=console.debug.bind(console),C.vdebug=console.debug.bind(console),C.log=console.log.bind(console),C.warn=console.warn.bind(console),C.error=console.error.bind(console);else if(Array.isArray(e.debug)){var r,n=Object(S.a)(e.debug);try{for(n.s();!(r=n.n()).done;){var t=r.value;switch(t){case"trace":C.trace=console.trace.bind(console);break;case"debug":C.debug=console.debug.bind(console);break;case"vdebug":C.vdebug=console.debug.bind(console);break;case"log":C.log=console.log.bind(console);break;case"warn":C.warn=console.warn.bind(console);break;case"error":C.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(f){n.e(f)}finally{n.f()}}C.log("Initializing library");var o=e.dependencies||C.getDefaultDependencies();C.isArray=o.isArray,C.webRTCAdapter=o.webRTCAdapter,C.httpAPICall=o.httpAPICall,C.newWebSocket=o.newWebSocket,C.extension=o.extension,C.extension.init(),C.listDevices=function(e,r){e="function"==typeof e?e:C.noop,null==r&&(r={audio:!0,video:!0}),C.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(r).then((function(r){navigator.mediaDevices.enumerateDevices().then((function(n){C.debug(n),e(n),C.stopAllTracks(r)}))})).catch((function(r){C.error(r),e([])})):(C.warn("navigator.mediaDevices unavailable"),e([]))},C.attachMediaStream=function(e,r){try{e.srcObject=r}catch(n){try{e.src=URL.createObjectURL(r)}catch(n){C.error("Error attaching stream to element")}}},C.reattachMediaStream=function(e,r){try{e.srcObject=r.srcObject}catch(n){try{e.src=r.src}catch(n){C.error("Error reattaching stream to element")}}};var a=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",i=window["on"+a];if(window.addEventListener(a,(function(e){for(var r in C.log("Closing window"),C.sessions)C.sessions[r]&&C.sessions[r].destroyOnUnload&&(C.log("Destroying session "+r),C.sessions[r].destroy({unload:!0,notifyDestroyed:!1}));i&&"function"==typeof i&&i()})),C.safariVp8=!1,"safari"===C.webRTCAdapter.browserDetails.browser&&C.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){var s,d=Object(S.a)(RTCRtpSender.getCapabilities("video").codecs);try{for(d.s();!(s=d.n()).done;){var c=s.value;if(c&&c.mimeType&&"video/vp8"===c.mimeType.toLowerCase()){C.safariVp8=!0;break}}}catch(f){d.e(f)}finally{d.f()}C.safariVp8?C.log("This version of Safari supports VP8"):C.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var l=new RTCPeerConnection({});l.createOffer({offerToReceiveVideo:!0}).then((function(e){C.safariVp8=-1!==e.sdp.indexOf("VP8"),C.safariVp8?C.log("This version of Safari supports VP8"):C.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),l.close(),l=null}))}if(C.unifiedPlan=!1,"firefox"===C.webRTCAdapter.browserDetails.browser&&C.webRTCAdapter.browserDetails.version>=59)C.unifiedPlan=!0;else if("chrome"===C.webRTCAdapter.browserDetails.browser&&C.webRTCAdapter.browserDetails.version>=72)C.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype){var u=new RTCPeerConnection;try{u.addTransceiver("audio"),C.unifiedPlan=!0}catch(v){}u.close()}else C.unifiedPlan=!1;C.initDone=!0,e.callback()}},C.isWebrtcSupported=function(){return!!window.RTCPeerConnection},C.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},C.randomString=function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<e;t++){var o=Math.floor(Math.random()*r.length);n+=r.substring(o,o+1)}return n};var A=C,D=null,x=null,O=null,R=35;function I(){A.init({debug:"all",callback:function(){x=new A({server:D,opaqueId:"\ubc15\uc2dc\uc5f0",success:function(){x.attach({plugin:"janus.plugin.videoroom",opaqueId:"\ubc15\uc2dc\uc5f0",success:function(e){O=e,A.log("Plugin attached! (".concat(O.getPlugin(),"\n                                    , ID = ").concat(O.getId(),")")),P(1234,R)},onmessage:function(e,r){A.debug(" ::: Got a message (publisher) :::",e);var n=e.videoroom;A.debug("Event: "+n),n&&"joined"===n&&(R=e.id,A.log("".concat(e.room,"\uc5d0 \uc131\uacf5\uc801\uc73c\ub85c \uc811\uc18d\ud558\uc600\uc2b5\ub2c8\ub2e4. ID = ").concat(R)),V(e)),r&&(A.debug("Handling SDP as well...",r),O.handleRemoteJsep({jsep:r}))},onlocalstream:function(e){A.debug(" ::: Got a local stream :::",e),A.log("onlocalstream \uc2e4\ud589");var r=document.getElementById("myvideo");A.attachMediaStream(r,e)},oncleanup:function(){}})},error:function(e){A.error(e)},destroyed:function(){window.location.reload()}})}})}function P(e,r){var n={request:"join",room:e,id:r,ptype:"publisher"};O.send({message:n,success:function(){return A.log("\ubc29\uc5d0 \uc811\uc18d\ud558\uc600\uc2b5\ub2c8\ub2e4 !"),!0},error:function(e){return A.error("WebRTC error:",e),A.log("\ubc29\uc5d0 \uc811\uc18d\ud558\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4 !"),!1}})}function V(e){O.createOffer({media:{audioRecv:!1,videoRecv:!1,audioSend:!1,videoSend:!0},success:function(e){A.log("Got publisher SDP!",e);O.send({message:{request:"configure",audio:!1,video:!0},jsep:e})},error:function(r){A.error("WebRTC error:",r),V(e)}})}function M(){return Object(d.jsxs)("div",{className:"TestBox",children:[Object(d.jsx)("span",{className:"TestTitle",children:"\ud734\ub300\ud3f0 \uce74\uba54\ub77c \uc124\uc815 \uc644\ub8cc"}),Object(d.jsx)("span",{className:"TestText",children:"\uc774 \ucc3d\uc744 \ub2eb\uc9c0 \ub9c8\uc2dc\uace0, \ucef4\ud4e8\ud130\uc5d0\uc11c \ubaa8\ubc14\uc77c \uae30\uae30\uc758 \ucd2c\uc601\uc774 \uc815\uc0c1\uc801\uc73c\ub85c \uc774\ub8e8\uc5b4\uc9c0\ub294\uc9c0 \ud655\uc778\ud558\uc138\uc694."})]})}D="http:"===window.location.protocol?"http://re-coder.net/janus":"https://re-coder.net/janus";var E=function(){var e=Object(t.useState)([!1]),r=Object(l.a)(e,2),n=r[0];r[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)(c,{}),Object(d.jsxs)("div",{className:"MainBox",children:[Object(d.jsx)("div",{className:"CameraBox",children:Object(d.jsx)("span",{className:"CameraTitle",children:"[\uce74\uba54\ub77c \ucd2c\uc601 \uc124\uc815]"})}),Object(d.jsx)("span",{children:"\uc5f0\uacb0 \uc2dc\uc791 \ubc84\ud2bc\uc744 \ub204\ub978 \ud6c4, \uce74\uba54\ub77c \uc811\uadfc \ud5c8\uc6a9\uc744 \ud574\uc57c \uc815\uc0c1\uc801\uc73c\ub85c \uc2dc\ud5d8\uc5d0 \uc751\uc2dc\uac00 \uac00\ub2a5\ud569\ub2c8\ub2e4."}),n?null:Object(d.jsx)(M,{}),Object(d.jsx)("button",{className:"TestButton",onClick:function(){return I()},children:"\uc5f0\uacb0 \uc2dc\uc791"}),Object(d.jsx)("div",{children:Object(d.jsx)("video",{className:"RTC ",id:"myvideo",autoPlay:!0,playsInline:!0,muted:"muted"})})]})]})};var N=function(){return Object(d.jsx)("div",{children:Object(d.jsxs)(i.a,{children:[Object(d.jsx)(s.a,{path:"/",exact:!0,component:g}),Object(d.jsx)(s.a,{path:"/Guide",exact:!0,component:w}),Object(d.jsx)(s.a,{path:"/Camera",exact:!0,component:E})]})})};a.a.render(Object(d.jsx)(N,{}),document.getElementById("root"))}},[[81,1,2]]]);
//# sourceMappingURL=main.02015eae.chunk.js.map