{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst NODE_TYPE = require(\"../node-type\");\n\nconst {\n  nodeLength,\n  nodeRoot\n} = require(\"../helpers/node\");\n\nconst {\n  domSymbolTree\n} = require(\"../helpers/internal-constants\");\n\nconst {\n  compareBoundaryPointsPosition\n} = require(\"../range/boundary-point\");\n\nconst {\n  setBoundaryPointStart,\n  setBoundaryPointEnd\n} = require(\"../range/Range-impl\");\n\nconst Range = require(\"../generated/Range\");\n\nconst {\n  implForWrapper\n} = require(\"../generated/utils\"); // https://w3c.github.io/selection-api/#dfn-direction\n\n\nconst SELECTION_DIRECTION = {\n  FORWARDS: 1,\n  BACKWARDS: -1,\n  DIRECTIONLESS: 0\n}; // https://w3c.github.io/selection-api/#dom-selection\n\nclass SelectionImpl {\n  constructor(globalObject) {\n    this._range = null;\n    this._direction = SELECTION_DIRECTION.DIRECTIONLESS;\n    this._globalObject = globalObject;\n  } // https://w3c.github.io/selection-api/#dom-selection-anchornode\n\n\n  get anchorNode() {\n    const anchor = this._anchor;\n    return anchor ? anchor.node : null;\n  } // https://w3c.github.io/selection-api/#dom-selection-anchoroffset\n\n\n  get anchorOffset() {\n    const anchor = this._anchor;\n    return anchor ? anchor.offset : 0;\n  } // https://w3c.github.io/selection-api/#dom-selection-focusnode\n\n\n  get focusNode() {\n    const focus = this._focus;\n    return focus ? focus.node : null;\n  } // https://w3c.github.io/selection-api/#dom-selection-focusoffset\n\n\n  get focusOffset() {\n    const focus = this._focus;\n    return focus ? focus.offset : 0;\n  } // https://w3c.github.io/selection-api/#dom-selection-iscollapsed\n\n\n  get isCollapsed() {\n    return this._range === null || this._range.collapsed;\n  } // https://w3c.github.io/selection-api/#dom-selection-rangecount\n\n\n  get rangeCount() {\n    return this._isEmpty() ? 0 : 1;\n  } // https://w3c.github.io/selection-api/#dom-selection-type\n\n\n  get type() {\n    if (this._isEmpty()) {\n      return \"None\";\n    } else if (this._range.collapsed) {\n      return \"Caret\";\n    }\n\n    return \"Range\";\n  } // https://w3c.github.io/selection-api/#dom-selection-getrangeat\n\n\n  getRangeAt(index) {\n    if (index !== 0 || this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\n    }\n\n    return this._range;\n  } // https://w3c.github.io/selection-api/#dom-selection-addrange\n\n\n  addRange(range) {\n    if (range._root === implForWrapper(this._globalObject._document) && this.rangeCount === 0) {\n      this._associateRange(range);\n    }\n  } // https://w3c.github.io/selection-api/#dom-selection-removerange\n\n\n  removeRange(range) {\n    if (range !== this._range) {\n      throw DOMException.create(this._globalObject, [\"Invalid range.\", \"NotFoundError\"]);\n    }\n\n    this._associateRange(null);\n  } // https://w3c.github.io/selection-api/#dom-selection-removeallranges\n\n\n  removeAllRanges() {\n    this._associateRange(null);\n  } // https://w3c.github.io/selection-api/#dom-selection-empty\n\n\n  empty() {\n    this.removeAllRanges();\n  } // https://w3c.github.io/selection-api/#dom-selection-collapse\n\n\n  collapse(node, offset) {\n    if (node === null) {\n      this.removeAllRanges();\n      return;\n    }\n\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n      throw DOMException.create(this._globalObject, [\"DocumentType Node can't be used as boundary point.\", \"InvalidNodeTypeError\"]);\n    }\n\n    if (offset > nodeLength(node)) {\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\n    }\n\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return;\n    }\n\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset: 0\n      },\n      end: {\n        node,\n        offset: 0\n      }\n    });\n    setBoundaryPointStart(newRange, node, offset);\n    setBoundaryPointEnd(newRange, node, offset);\n\n    this._associateRange(newRange);\n  } // https://w3c.github.io/selection-api/#dom-selection-setposition\n\n\n  setPosition(node, offset) {\n    this.collapse(node, offset);\n  } // https://w3c.github.io/selection-api/#dom-selection-collapsetostart\n\n\n  collapseToStart() {\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\n    }\n\n    const {\n      node,\n      offset\n    } = this._range._start;\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset\n      },\n      end: {\n        node,\n        offset\n      }\n    });\n\n    this._associateRange(newRange);\n  } // https://w3c.github.io/selection-api/#dom-selection-collapsetoend\n\n\n  collapseToEnd() {\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\n    }\n\n    const {\n      node,\n      offset\n    } = this._range._end;\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset\n      },\n      end: {\n        node,\n        offset\n      }\n    });\n\n    this._associateRange(newRange);\n  } // https://w3c.github.io/selection-api/#dom-selection-extend\n\n\n  extend(node, offset) {\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return;\n    }\n\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to extend.\", \"InvalidStateError\"]);\n    }\n\n    const {\n      _anchor: oldAnchor\n    } = this;\n    const newFocus = {\n      node,\n      offset\n    };\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset: 0\n      },\n      end: {\n        node,\n        offset: 0\n      }\n    });\n\n    if (nodeRoot(node) !== this._range._root) {\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\n    } else if (compareBoundaryPointsPosition(oldAnchor, newFocus) <= 0) {\n      setBoundaryPointStart(newRange, oldAnchor.node, oldAnchor.offset);\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\n    } else {\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\n      setBoundaryPointEnd(newRange, oldAnchor.node, oldAnchor.offset);\n    }\n\n    this._associateRange(newRange);\n\n    this._direction = compareBoundaryPointsPosition(newFocus, oldAnchor) === -1 ? SELECTION_DIRECTION.BACKWARDS : SELECTION_DIRECTION.FORWARDS;\n  } // https://w3c.github.io/selection-api/#dom-selection-setbaseandextent\n\n\n  setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset) {\n    if (anchorOffset > nodeLength(anchorNode) || focusOffset > nodeLength(focusNode)) {\n      throw DOMException.create(this._globalObject, [\"Invalid anchor or focus offset.\", \"IndexSizeError\"]);\n    }\n\n    const document = implForWrapper(this._globalObject._document);\n\n    if (document !== nodeRoot(anchorNode) || document !== nodeRoot(focusNode)) {\n      return;\n    }\n\n    const anchor = {\n      node: anchorNode,\n      offset: anchorOffset\n    };\n    const focus = {\n      node: focusNode,\n      offset: focusOffset\n    };\n    let newRange;\n\n    if (compareBoundaryPointsPosition(anchor, focus) === -1) {\n      newRange = Range.createImpl(this._globalObject, [], {\n        start: {\n          node: anchor.node,\n          offset: anchor.offset\n        },\n        end: {\n          node: focus.node,\n          offset: focus.offset\n        }\n      });\n    } else {\n      newRange = Range.createImpl(this._globalObject, [], {\n        start: {\n          node: focus.node,\n          offset: focus.offset\n        },\n        end: {\n          node: anchor.node,\n          offset: anchor.offset\n        }\n      });\n    }\n\n    this._associateRange(newRange);\n\n    this._direction = compareBoundaryPointsPosition(focus, anchor) === -1 ? SELECTION_DIRECTION.BACKWARDS : SELECTION_DIRECTION.FORWARDS;\n  } // https://w3c.github.io/selection-api/#dom-selection-selectallchildren\n\n\n  selectAllChildren(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n      throw DOMException.create(this._globalObject, [\"DocumentType Node can't be used as boundary point.\", \"InvalidNodeTypeError\"]);\n    }\n\n    const document = implForWrapper(this._globalObject._document);\n\n    if (document !== nodeRoot(node)) {\n      return;\n    }\n\n    const length = domSymbolTree.childrenCount(node);\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: {\n        node,\n        offset: 0\n      },\n      end: {\n        node,\n        offset: 0\n      }\n    });\n    setBoundaryPointStart(newRange, node, 0);\n    setBoundaryPointEnd(newRange, node, length);\n\n    this._associateRange(newRange);\n  } // https://w3c.github.io/selection-api/#dom-selection-deletefromdocument\n\n\n  deleteFromDocument() {\n    if (!this._isEmpty()) {\n      this._range.deleteContents();\n    }\n  } // https://w3c.github.io/selection-api/#dom-selection-containsnode\n\n\n  containsNode(node, allowPartialContainment) {\n    if (this._isEmpty() || nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return false;\n    }\n\n    const {\n      _start,\n      _end\n    } = this._range;\n    const startIsBeforeNode = compareBoundaryPointsPosition(_start, {\n      node,\n      offset: 0\n    }) === -1;\n    const endIsAfterNode = compareBoundaryPointsPosition(_end, {\n      node,\n      offset: nodeLength(node)\n    }) === 1;\n    return allowPartialContainment ? startIsBeforeNode || endIsAfterNode : startIsBeforeNode && endIsAfterNode;\n  } // https://w3c.github.io/selection-api/#dom-selection-stringifier\n\n\n  toString() {\n    return this._range ? this._range.toString() : \"\";\n  } // https://w3c.github.io/selection-api/#dfn-empty\n\n\n  _isEmpty() {\n    return this._range === null;\n  } // https://w3c.github.io/selection-api/#dfn-anchor\n\n\n  get _anchor() {\n    if (!this._range) {\n      return null;\n    }\n\n    return this._direction === SELECTION_DIRECTION.FORWARDS ? this._range._start : this._range._end;\n  } // https://w3c.github.io/selection-api/#dfn-focus\n\n\n  get _focus() {\n    if (!this._range) {\n      return null;\n    }\n\n    return this._direction === SELECTION_DIRECTION.FORWARDS ? this._range._end : this._range._start;\n  }\n\n  _associateRange(newRange) {\n    this._range = newRange;\n    this._direction = newRange === null ? SELECTION_DIRECTION.DIRECTIONLESS : SELECTION_DIRECTION.FORWARDS; // TODO: Emit \"selectionchange\" event. At this time, there is currently no test in WPT covering this.\n    // https://w3c.github.io/selection-api/#selectionchange-event\n  }\n\n}\n\nmodule.exports = {\n  implementation: SelectionImpl\n};","map":{"version":3,"sources":["/Library/WebServer/Documents/capstone/capstone-project-re-coder/node_modules/jsdom/lib/jsdom/living/selection/Selection-impl.js"],"names":["DOMException","require","NODE_TYPE","nodeLength","nodeRoot","domSymbolTree","compareBoundaryPointsPosition","setBoundaryPointStart","setBoundaryPointEnd","Range","implForWrapper","SELECTION_DIRECTION","FORWARDS","BACKWARDS","DIRECTIONLESS","SelectionImpl","constructor","globalObject","_range","_direction","_globalObject","anchorNode","anchor","_anchor","node","anchorOffset","offset","focusNode","focus","_focus","focusOffset","isCollapsed","collapsed","rangeCount","_isEmpty","type","getRangeAt","index","create","addRange","range","_root","_document","_associateRange","removeRange","removeAllRanges","empty","collapse","nodeType","DOCUMENT_TYPE_NODE","newRange","createImpl","start","end","setPosition","collapseToStart","_start","collapseToEnd","_end","extend","oldAnchor","newFocus","setBaseAndExtent","document","selectAllChildren","length","childrenCount","deleteFromDocument","deleteContents","containsNode","allowPartialContainment","startIsBeforeNode","endIsAfterNode","toString","module","exports","implementation"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst NODE_TYPE = require(\"../node-type\");\nconst { nodeLength, nodeRoot } = require(\"../helpers/node\");\nconst { domSymbolTree } = require(\"../helpers/internal-constants\");\nconst { compareBoundaryPointsPosition } = require(\"../range/boundary-point\");\n\nconst { setBoundaryPointStart, setBoundaryPointEnd } = require(\"../range/Range-impl\");\n\nconst Range = require(\"../generated/Range\");\nconst { implForWrapper } = require(\"../generated/utils\");\n\n// https://w3c.github.io/selection-api/#dfn-direction\nconst SELECTION_DIRECTION = {\n  FORWARDS: 1,\n  BACKWARDS: -1,\n  DIRECTIONLESS: 0\n};\n\n// https://w3c.github.io/selection-api/#dom-selection\nclass SelectionImpl {\n  constructor(globalObject) {\n    this._range = null;\n    this._direction = SELECTION_DIRECTION.DIRECTIONLESS;\n\n    this._globalObject = globalObject;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-anchornode\n  get anchorNode() {\n    const anchor = this._anchor;\n    return anchor ? anchor.node : null;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-anchoroffset\n  get anchorOffset() {\n    const anchor = this._anchor;\n    return anchor ? anchor.offset : 0;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-focusnode\n  get focusNode() {\n    const focus = this._focus;\n    return focus ? focus.node : null;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-focusoffset\n  get focusOffset() {\n    const focus = this._focus;\n    return focus ? focus.offset : 0;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-iscollapsed\n  get isCollapsed() {\n    return this._range === null || this._range.collapsed;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-rangecount\n  get rangeCount() {\n    return this._isEmpty() ? 0 : 1;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-type\n  get type() {\n    if (this._isEmpty()) {\n      return \"None\";\n    } else if (this._range.collapsed) {\n      return \"Caret\";\n    }\n\n    return \"Range\";\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-getrangeat\n  getRangeAt(index) {\n    if (index !== 0 || this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\n    }\n\n    return this._range;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-addrange\n  addRange(range) {\n    if (range._root === implForWrapper(this._globalObject._document) && this.rangeCount === 0) {\n      this._associateRange(range);\n    }\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-removerange\n  removeRange(range) {\n    if (range !== this._range) {\n      throw DOMException.create(this._globalObject, [\"Invalid range.\", \"NotFoundError\"]);\n    }\n\n    this._associateRange(null);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-removeallranges\n  removeAllRanges() {\n    this._associateRange(null);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-empty\n  empty() {\n    this.removeAllRanges();\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-collapse\n  collapse(node, offset) {\n    if (node === null) {\n      this.removeAllRanges();\n      return;\n    }\n\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n      throw DOMException.create(this._globalObject, [\n        \"DocumentType Node can't be used as boundary point.\",\n        \"InvalidNodeTypeError\"\n      ]);\n    }\n\n    if (offset > nodeLength(node)) {\n      throw DOMException.create(this._globalObject, [\"Invalid range index.\", \"IndexSizeError\"]);\n    }\n\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return;\n    }\n\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: { node, offset: 0 },\n      end: { node, offset: 0 }\n    });\n\n    setBoundaryPointStart(newRange, node, offset);\n    setBoundaryPointEnd(newRange, node, offset);\n\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-setposition\n  setPosition(node, offset) {\n    this.collapse(node, offset);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-collapsetostart\n  collapseToStart() {\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\n    }\n\n    const { node, offset } = this._range._start;\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: { node, offset },\n      end: { node, offset }\n    });\n\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-collapsetoend\n  collapseToEnd() {\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to collapse.\", \"InvalidStateError\"]);\n    }\n\n    const { node, offset } = this._range._end;\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: { node, offset },\n      end: { node, offset }\n    });\n\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-extend\n  extend(node, offset) {\n    if (nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return;\n    }\n\n    if (this._isEmpty()) {\n      throw DOMException.create(this._globalObject, [\"There is no selection to extend.\", \"InvalidStateError\"]);\n    }\n\n    const { _anchor: oldAnchor } = this;\n    const newFocus = { node, offset };\n\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: { node, offset: 0 },\n      end: { node, offset: 0 }\n    });\n\n    if (nodeRoot(node) !== this._range._root) {\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\n    } else if (compareBoundaryPointsPosition(oldAnchor, newFocus) <= 0) {\n      setBoundaryPointStart(newRange, oldAnchor.node, oldAnchor.offset);\n      setBoundaryPointEnd(newRange, newFocus.node, newFocus.offset);\n    } else {\n      setBoundaryPointStart(newRange, newFocus.node, newFocus.offset);\n      setBoundaryPointEnd(newRange, oldAnchor.node, oldAnchor.offset);\n    }\n\n    this._associateRange(newRange);\n\n    this._direction = compareBoundaryPointsPosition(newFocus, oldAnchor) === -1 ?\n      SELECTION_DIRECTION.BACKWARDS :\n      SELECTION_DIRECTION.FORWARDS;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-setbaseandextent\n  setBaseAndExtent(anchorNode, anchorOffset, focusNode, focusOffset) {\n    if (anchorOffset > nodeLength(anchorNode) || focusOffset > nodeLength(focusNode)) {\n      throw DOMException.create(this._globalObject, [\"Invalid anchor or focus offset.\", \"IndexSizeError\"]);\n    }\n\n    const document = implForWrapper(this._globalObject._document);\n    if (document !== nodeRoot(anchorNode) || document !== nodeRoot(focusNode)) {\n      return;\n    }\n\n    const anchor = { node: anchorNode, offset: anchorOffset };\n    const focus = { node: focusNode, offset: focusOffset };\n\n    let newRange;\n    if (compareBoundaryPointsPosition(anchor, focus) === -1) {\n      newRange = Range.createImpl(this._globalObject, [], {\n        start: { node: anchor.node, offset: anchor.offset },\n        end: { node: focus.node, offset: focus.offset }\n      });\n    } else {\n      newRange = Range.createImpl(this._globalObject, [], {\n        start: { node: focus.node, offset: focus.offset },\n        end: { node: anchor.node, offset: anchor.offset }\n      });\n    }\n\n    this._associateRange(newRange);\n\n    this._direction = compareBoundaryPointsPosition(focus, anchor) === -1 ?\n      SELECTION_DIRECTION.BACKWARDS :\n      SELECTION_DIRECTION.FORWARDS;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-selectallchildren\n  selectAllChildren(node) {\n    if (node.nodeType === NODE_TYPE.DOCUMENT_TYPE_NODE) {\n      throw DOMException.create(this._globalObject, [\n        \"DocumentType Node can't be used as boundary point.\",\n        \"InvalidNodeTypeError\"\n      ]);\n    }\n\n    const document = implForWrapper(this._globalObject._document);\n    if (document !== nodeRoot(node)) {\n      return;\n    }\n\n    const length = domSymbolTree.childrenCount(node);\n\n    const newRange = Range.createImpl(this._globalObject, [], {\n      start: { node, offset: 0 },\n      end: { node, offset: 0 }\n    });\n\n    setBoundaryPointStart(newRange, node, 0);\n    setBoundaryPointEnd(newRange, node, length);\n\n    this._associateRange(newRange);\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-deletefromdocument\n  deleteFromDocument() {\n    if (!this._isEmpty()) {\n      this._range.deleteContents();\n    }\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-containsnode\n  containsNode(node, allowPartialContainment) {\n    if (this._isEmpty() || nodeRoot(node) !== implForWrapper(this._globalObject._document)) {\n      return false;\n    }\n\n    const { _start, _end } = this._range;\n\n    const startIsBeforeNode = compareBoundaryPointsPosition(_start, { node, offset: 0 }) === -1;\n    const endIsAfterNode = compareBoundaryPointsPosition(_end, { node, offset: nodeLength(node) }) === 1;\n\n    return allowPartialContainment ?\n      startIsBeforeNode || endIsAfterNode :\n      startIsBeforeNode && endIsAfterNode;\n  }\n\n  // https://w3c.github.io/selection-api/#dom-selection-stringifier\n  toString() {\n    return this._range ? this._range.toString() : \"\";\n  }\n\n  // https://w3c.github.io/selection-api/#dfn-empty\n  _isEmpty() {\n    return this._range === null;\n  }\n\n  // https://w3c.github.io/selection-api/#dfn-anchor\n  get _anchor() {\n    if (!this._range) {\n      return null;\n    }\n\n    return this._direction === SELECTION_DIRECTION.FORWARDS ?\n      this._range._start :\n      this._range._end;\n  }\n\n  // https://w3c.github.io/selection-api/#dfn-focus\n  get _focus() {\n    if (!this._range) {\n      return null;\n    }\n\n    return this._direction === SELECTION_DIRECTION.FORWARDS ?\n      this._range._end :\n      this._range._start;\n  }\n\n  _associateRange(newRange) {\n    this._range = newRange;\n    this._direction = newRange === null ? SELECTION_DIRECTION.DIRECTIONLESS : SELECTION_DIRECTION.FORWARDS;\n\n    // TODO: Emit \"selectionchange\" event. At this time, there is currently no test in WPT covering this.\n    // https://w3c.github.io/selection-api/#selectionchange-event\n  }\n}\n\nmodule.exports = {\n  implementation: SelectionImpl\n};\n"]},"metadata":{},"sourceType":"script"}