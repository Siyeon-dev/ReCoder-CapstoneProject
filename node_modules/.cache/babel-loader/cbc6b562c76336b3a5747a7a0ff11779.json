{"ast":null,"code":"\"use strict\";\n\nconst idlUtils = require(\"../../living/generated/utils\");\n\nconst {\n  fireAnEvent\n} = require(\"../../living/helpers/events\");\n\nmodule.exports = class PerDocumentResourceLoader {\n  constructor(document) {\n    this._document = document;\n    this._defaultEncoding = document._encoding;\n    this._resourceLoader = document._defaultView ? document._defaultView._resourceLoader : null;\n    this._requestManager = document._requestManager;\n    this._queue = document._queue;\n    this._deferQueue = document._deferQueue;\n    this._asyncQueue = document._asyncQueue;\n  }\n\n  fetch(url, {\n    element,\n    onLoad,\n    onError\n  }) {\n    const request = this._resourceLoader.fetch(url, {\n      cookieJar: this._document._cookieJar,\n      element: idlUtils.wrapperForImpl(element),\n      referrer: this._document.URL\n    });\n\n    if (request === null) {\n      return null;\n    }\n\n    this._requestManager.add(request);\n\n    const onErrorWrapped = error => {\n      this._requestManager.remove(request);\n\n      if (onError) {\n        onError(error);\n      }\n\n      fireAnEvent(\"error\", element);\n      const err = new Error(`Could not load ${element.localName}: \"${url}\"`);\n      err.type = \"resource loading\";\n      err.detail = error;\n\n      this._document._defaultView._virtualConsole.emit(\"jsdomError\", err);\n\n      return Promise.resolve();\n    };\n\n    const onLoadWrapped = data => {\n      this._requestManager.remove(request);\n\n      this._addCookies(url, request.response ? request.response.headers : {});\n\n      try {\n        const result = onLoad ? onLoad(data) : undefined;\n        return Promise.resolve(result).then(() => {\n          fireAnEvent(\"load\", element);\n          return Promise.resolve();\n        }).catch(err => {\n          return onErrorWrapped(err);\n        });\n      } catch (err) {\n        return onErrorWrapped(err);\n      }\n    };\n\n    if (element.localName === \"script\" && element.hasAttributeNS(null, \"async\")) {\n      this._asyncQueue.push(request, onLoadWrapped, onErrorWrapped, this._queue.getLastScript());\n    } else if (element.localName === \"script\" && element.hasAttributeNS(null, \"defer\")) {\n      this._deferQueue.push(request, onLoadWrapped, onErrorWrapped, false, element);\n    } else {\n      this._queue.push(request, onLoadWrapped, onErrorWrapped, false, element);\n    }\n\n    return request;\n  }\n\n  _addCookies(url, headers) {\n    let cookies = headers[\"set-cookie\"];\n\n    if (!cookies) {\n      return;\n    }\n\n    if (!Array.isArray(cookies)) {\n      cookies = [cookies];\n    }\n\n    cookies.forEach(cookie => {\n      this._document._cookieJar.setCookieSync(cookie, url, {\n        http: true,\n        ignoreError: true\n      });\n    });\n  }\n\n};","map":{"version":3,"sources":["/Library/WebServer/Documents/capstone/capstone-project-re-coder/node_modules/jsdom/lib/jsdom/browser/resources/per-document-resource-loader.js"],"names":["idlUtils","require","fireAnEvent","module","exports","PerDocumentResourceLoader","constructor","document","_document","_defaultEncoding","_encoding","_resourceLoader","_defaultView","_requestManager","_queue","_deferQueue","_asyncQueue","fetch","url","element","onLoad","onError","request","cookieJar","_cookieJar","wrapperForImpl","referrer","URL","add","onErrorWrapped","error","remove","err","Error","localName","type","detail","_virtualConsole","emit","Promise","resolve","onLoadWrapped","data","_addCookies","response","headers","result","undefined","then","catch","hasAttributeNS","push","getLastScript","cookies","Array","isArray","forEach","cookie","setCookieSync","http","ignoreError"],"mappings":"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","sourcesContent":["\"use strict\";\nconst idlUtils = require(\"../../living/generated/utils\");\nconst { fireAnEvent } = require(\"../../living/helpers/events\");\n\nmodule.exports = class PerDocumentResourceLoader {\n  constructor(document) {\n    this._document = document;\n    this._defaultEncoding = document._encoding;\n    this._resourceLoader = document._defaultView ? document._defaultView._resourceLoader : null;\n    this._requestManager = document._requestManager;\n    this._queue = document._queue;\n    this._deferQueue = document._deferQueue;\n    this._asyncQueue = document._asyncQueue;\n  }\n\n  fetch(url, { element, onLoad, onError }) {\n    const request = this._resourceLoader.fetch(url, {\n      cookieJar: this._document._cookieJar,\n      element: idlUtils.wrapperForImpl(element),\n      referrer: this._document.URL\n    });\n\n    if (request === null) {\n      return null;\n    }\n\n    this._requestManager.add(request);\n\n    const onErrorWrapped = error => {\n      this._requestManager.remove(request);\n\n      if (onError) {\n        onError(error);\n      }\n\n      fireAnEvent(\"error\", element);\n\n      const err = new Error(`Could not load ${element.localName}: \"${url}\"`);\n      err.type = \"resource loading\";\n      err.detail = error;\n\n      this._document._defaultView._virtualConsole.emit(\"jsdomError\", err);\n\n      return Promise.resolve();\n    };\n\n    const onLoadWrapped = data => {\n      this._requestManager.remove(request);\n\n      this._addCookies(url, request.response ? request.response.headers : {});\n\n      try {\n        const result = onLoad ? onLoad(data) : undefined;\n\n        return Promise.resolve(result)\n          .then(() => {\n            fireAnEvent(\"load\", element);\n\n            return Promise.resolve();\n          })\n          .catch(err => {\n            return onErrorWrapped(err);\n          });\n      } catch (err) {\n        return onErrorWrapped(err);\n      }\n    };\n\n    if (element.localName === \"script\" && element.hasAttributeNS(null, \"async\")) {\n      this._asyncQueue.push(request, onLoadWrapped, onErrorWrapped, this._queue.getLastScript());\n    } else if (element.localName === \"script\" && element.hasAttributeNS(null, \"defer\")) {\n      this._deferQueue.push(request, onLoadWrapped, onErrorWrapped, false, element);\n    } else {\n      this._queue.push(request, onLoadWrapped, onErrorWrapped, false, element);\n    }\n\n    return request;\n  }\n\n  _addCookies(url, headers) {\n    let cookies = headers[\"set-cookie\"];\n\n    if (!cookies) {\n      return;\n    }\n\n    if (!Array.isArray(cookies)) {\n      cookies = [cookies];\n    }\n\n    cookies.forEach(cookie => {\n      this._document._cookieJar.setCookieSync(cookie, url, { http: true, ignoreError: true });\n    });\n  }\n};\n"]},"metadata":{},"sourceType":"script"}