{"ast":null,"code":"\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst StorageEvent = require(\"../generated/StorageEvent\");\n\nconst idlUtils = require(\"../generated/utils\");\n\nconst {\n  fireAnEvent\n} = require(\"../helpers/events\"); // https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\n\n\nclass StorageImpl {\n  constructor(globalObject, args, privateData) {\n    const {\n      associatedWindow,\n      storageArea,\n      url,\n      type,\n      storageQuota\n    } = privateData;\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n    this._globalObject = globalObject;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin.filter(target => target !== this._associatedWindow).forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n      key,\n      oldValue,\n      newValue,\n      url: this._url,\n      storageArea: target[\"_\" + this._type]\n    }));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    } // Concatenate all keys and values to measure their length against the quota\n\n\n    let itemsTotalLength = key.length + value.length;\n\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n\n    if (itemsTotalLength > this._quota) {\n      throw DOMException.create(this._globalObject, [`The ${this._quota}-code unit storage quota has been exceeded.`, \"QuotaExceededError\"]);\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};","map":{"version":3,"sources":["/Library/WebServer/Documents/capstone/capstone-project-re-coder/node_modules/jsdom/lib/jsdom/living/webstorage/Storage-impl.js"],"names":["DOMException","require","StorageEvent","idlUtils","fireAnEvent","StorageImpl","constructor","globalObject","args","privateData","associatedWindow","storageArea","url","type","storageQuota","_associatedWindow","_items","_url","_type","_quota","_globalObject","_dispatchStorageEvent","key","oldValue","newValue","_currentOriginData","windowsInSameOrigin","filter","target","forEach","length","size","n","keys","getItem","has","get","setItem","value","itemsTotalLength","curKey","curValue","create","setTimeout","bind","set","removeItem","delete","clear","supportedPropertyNames","module","exports","implementation"],"mappings":"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","sourcesContent":["\"use strict\";\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst StorageEvent = require(\"../generated/StorageEvent\");\nconst idlUtils = require(\"../generated/utils\");\nconst { fireAnEvent } = require(\"../helpers/events\");\n\n// https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface\nclass StorageImpl {\n  constructor(globalObject, args, privateData) {\n    const { associatedWindow, storageArea, url, type, storageQuota } = privateData;\n\n    this._associatedWindow = associatedWindow;\n    this._items = storageArea;\n    this._url = url;\n    this._type = type;\n    this._quota = storageQuota;\n\n    this._globalObject = globalObject;\n  }\n\n  _dispatchStorageEvent(key, oldValue, newValue) {\n    return this._associatedWindow._currentOriginData.windowsInSameOrigin\n      .filter(target => target !== this._associatedWindow)\n      .forEach(target => fireAnEvent(\"storage\", target, StorageEvent, {\n        key,\n        oldValue,\n        newValue,\n        url: this._url,\n        storageArea: target[\"_\" + this._type]\n      }));\n  }\n\n  get length() {\n    return this._items.size;\n  }\n\n  key(n) {\n    if (n >= this._items.size) {\n      return null;\n    }\n    return [...this._items.keys()][n];\n  }\n\n  getItem(key) {\n    if (this._items.has(key)) {\n      return this._items.get(key);\n    }\n    return null;\n  }\n\n  setItem(key, value) {\n    const oldValue = this._items.get(key) || null;\n\n    if (oldValue === value) {\n      return;\n    }\n\n    // Concatenate all keys and values to measure their length against the quota\n    let itemsTotalLength = key.length + value.length;\n    for (const [curKey, curValue] of this._items) {\n      // If the key already exists, skip it as it will be set to the new value instead\n      if (key !== curKey) {\n        itemsTotalLength += curKey.length + curValue.length;\n      }\n    }\n    if (itemsTotalLength > this._quota) {\n      throw DOMException.create(this._globalObject, [\n        `The ${this._quota}-code unit storage quota has been exceeded.`,\n        \"QuotaExceededError\"\n      ]);\n    }\n\n    setTimeout(this._dispatchStorageEvent.bind(this), 0, key, oldValue, value);\n\n    this._items.set(key, value);\n  }\n\n  removeItem(key) {\n    if (this._items.has(key)) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, key, this._items.get(key), null);\n\n      this._items.delete(key);\n    }\n  }\n\n  clear() {\n    if (this._items.size > 0) {\n      setTimeout(this._dispatchStorageEvent.bind(this), 0, null, null, null);\n\n      this._items.clear();\n    }\n  }\n\n  get [idlUtils.supportedPropertyNames]() {\n    return this._items.keys();\n  }\n}\n\nmodule.exports = {\n  implementation: StorageImpl\n};\n"]},"metadata":{},"sourceType":"script"}