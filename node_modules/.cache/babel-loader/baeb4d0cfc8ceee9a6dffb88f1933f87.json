{"ast":null,"code":"\"use strict\";\n\nconst vm = require(\"vm\");\n\nconst webIDLConversions = require(\"webidl-conversions\");\n\nconst {\n  CSSStyleDeclaration\n} = require(\"cssstyle\");\n\nconst {\n  Performance: RawPerformance\n} = require(\"w3c-hr-time\");\n\nconst notImplemented = require(\"./not-implemented\");\n\nconst {\n  installInterfaces\n} = require(\"../living/interfaces\");\n\nconst {\n  define,\n  mixin\n} = require(\"../utils\");\n\nconst Element = require(\"../living/generated/Element\");\n\nconst EventTarget = require(\"../living/generated/EventTarget\");\n\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\n\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\n\nconst postMessage = require(\"../living/post-message\");\n\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\n\nconst {\n  btoa,\n  atob\n} = require(\"abab\");\n\nconst idlUtils = require(\"../living/generated/utils\");\n\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\n\nconst BarProp = require(\"../living/generated/BarProp\");\n\nconst documents = require(\"../living/documents.js\");\n\nconst External = require(\"../living/generated/External\");\n\nconst Navigator = require(\"../living/generated/Navigator\");\n\nconst Performance = require(\"../living/generated/Performance\");\n\nconst Screen = require(\"../living/generated/Screen\");\n\nconst Storage = require(\"../living/generated/Storage\");\n\nconst Selection = require(\"../living/generated/Selection\");\n\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\n\nconst {\n  fireAnEvent\n} = require(\"../living/helpers/events\");\n\nconst SessionHistory = require(\"../living/window/SessionHistory\");\n\nconst {\n  forEachMatchingSheetRuleOfElement,\n  getResolvedValue,\n  propertiesWithResolvedValueImplemented,\n  SHADOW_DOM_PSEUDO_REGEXP\n} = require(\"../living/helpers/style-rules.js\");\n\nconst CustomElementRegistry = require(\"../living/generated/CustomElementRegistry\");\n\nconst jsGlobals = require(\"./js-globals.json\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\n\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nexports.createWindow = function (options) {\n  return new Window(options);\n};\n\nconst jsGlobalEntriesToInstall = Object.entries(jsGlobals).filter(([name]) => name in global); // https://html.spec.whatwg.org/#the-window-object\n\nfunction setupWindow(windowInstance, {\n  runScripts\n}) {\n  if (runScripts === \"outside-only\" || runScripts === \"dangerously\") {\n    contextifyWindow(windowInstance); // Without this, these globals will only appear to scripts running inside the context using vm.runScript; they will\n    // not appear to scripts running from the outside, including to JSDOM implementation code.\n\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc,\n        value: vm.runInContext(globalName, windowInstance)\n      };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  } else {\n    // Without contextifying the window, none of the globals will exist. So, let's at least alias them from the Node.js\n    // context. See https://github.com/jsdom/jsdom/issues/2727 for more background and discussion.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc,\n        value: global[globalName]\n      };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  }\n\n  installInterfaces(windowInstance, [\"Window\"]);\n  const EventTargetConstructor = windowInstance.EventTarget; // eslint-disable-next-line func-name-matching, func-style, no-shadow\n\n  const windowConstructor = function Window() {\n    throw new TypeError(\"Illegal constructor\");\n  };\n\n  Object.setPrototypeOf(windowConstructor, EventTargetConstructor);\n  Object.defineProperty(windowInstance, \"Window\", {\n    configurable: true,\n    writable: true,\n    value: windowConstructor\n  });\n  const windowPrototype = Object.create(EventTargetConstructor.prototype);\n  Object.defineProperties(windowPrototype, {\n    constructor: {\n      value: windowConstructor,\n      writable: true,\n      configurable: true\n    },\n    [Symbol.toStringTag]: {\n      value: \"Window\",\n      configurable: true\n    }\n  });\n  windowConstructor.prototype = windowPrototype;\n  Object.setPrototypeOf(windowInstance, windowPrototype);\n  EventTarget.setup(windowInstance, windowInstance);\n  mixin(windowInstance, WindowEventHandlersImpl.prototype);\n  mixin(windowInstance, GlobalEventHandlersImpl.prototype);\n\n  windowInstance._initGlobalEvents();\n\n  windowInstance._globalObject = windowInstance;\n} // NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\n\n\nfunction Window(options) {\n  setupWindow(this, {\n    runScripts: options.runScripts\n  });\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n  const window = this; ///// PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader; // vm initialization is deferred until script processing is activated\n\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, {\n    get: () => this._globalProxy\n  }); // List options explicitly to be clear which are passed through\n\n  this._document = documents.createWrapper(window, {\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    encoding: options.encoding,\n    cookieJar: options.cookieJar,\n    url: options.url,\n    lastModified: options.lastModified,\n    referrer: options.referrer,\n    concurrentNodeIterators: options.concurrentNodeIterators,\n    parseOptions: options.parseOptions,\n    defaultView: this._globalProxy,\n    global: this\n  }, {\n    alwaysUseDocumentClass: true\n  });\n\n  if (vm.isContext(window)) {\n    const documentImpl = idlUtils.implForWrapper(window._document);\n    documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n  }\n\n  const documentOrigin = idlUtils.implForWrapper(this._document)._origin;\n\n  this._origin = documentOrigin; // https://html.spec.whatwg.org/#session-history\n\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n  this._virtualConsole = options.virtualConsole;\n  this._runScripts = options.runScripts; // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null; // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n\n  this._length = 0;\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota; // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n\n  if (options.commonForOrigin && options.commonForOrigin[documentOrigin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [documentOrigin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[documentOrigin]; ///// WEB STORAGE\n\n  this._localStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  }); ///// SELECTION\n  // https://w3c.github.io/selection-api/#dfn-selection\n\n  this._selection = Selection.createImpl(window); // https://w3c.github.io/selection-api/#dom-window\n\n  this.getSelection = function () {\n    return window._selection;\n  }; ///// GETTERS\n\n\n  const locationbar = BarProp.create(window);\n  const menubar = BarProp.create(window);\n  const personalbar = BarProp.create(window);\n  const scrollbars = BarProp.create(window);\n  const statusbar = BarProp.create(window);\n  const toolbar = BarProp.create(window);\n  const external = External.create(window);\n  const navigator = Navigator.create(window, [], {\n    userAgent: this._resourceLoader._userAgent\n  });\n  const performance = Performance.create(window, [], {\n    rawPerformance\n  });\n  const screen = Screen.create(window);\n  const customElementRegistry = CustomElementRegistry.create(window);\n  define(this, {\n    get length() {\n      return window._length;\n    },\n\n    get window() {\n      return window._globalProxy;\n    },\n\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n\n    get frames() {\n      return window._globalProxy;\n    },\n\n    get self() {\n      return window._globalProxy;\n    },\n\n    get parent() {\n      return window._parent;\n    },\n\n    get top() {\n      return window._top;\n    },\n\n    get document() {\n      return window._document;\n    },\n\n    get external() {\n      return external;\n    },\n\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n\n    get navigator() {\n      return navigator;\n    },\n\n    get locationbar() {\n      return locationbar;\n    },\n\n    get menubar() {\n      return menubar;\n    },\n\n    get personalbar() {\n      return personalbar;\n    },\n\n    get scrollbars() {\n      return scrollbars;\n    },\n\n    get statusbar() {\n      return statusbar;\n    },\n\n    get toolbar() {\n      return toolbar;\n    },\n\n    get performance() {\n      return performance;\n    },\n\n    get screen() {\n      return screen;\n    },\n\n    get origin() {\n      return window._origin;\n    },\n\n    // The origin IDL attribute is defined with [Replaceable].\n    set origin(value) {\n      Object.defineProperty(this, \"origin\", {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    },\n\n    get localStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\"localStorage is not available for opaque origins\", \"SecurityError\"]);\n      }\n\n      return this._localStorage;\n    },\n\n    get sessionStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\"sessionStorage is not available for opaque origins\", \"SecurityError\"]);\n      }\n\n      return this._sessionStorage;\n    },\n\n    get customElements() {\n      return customElementRegistry;\n    }\n\n  });\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy); ///// METHODS\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n  // In the spec the list of active timers is a set of IDs. We make it a map of IDs to Node.js timer objects, so that\n  // we can call Node.js-side clearTimeout() when clearing, and thus allow process shutdown faster.\n\n  const listOfActiveTimers = new Map();\n  let latestTimerId = 0;\n\n  this.setTimeout = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n\n    timeout = webIDLConversions.long(timeout);\n    return timerInitializationSteps(handler, timeout, args, {\n      methodContext: window,\n      repeat: false\n    });\n  };\n\n  this.setInterval = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n\n    timeout = webIDLConversions.long(timeout);\n    return timerInitializationSteps(handler, timeout, args, {\n      methodContext: window,\n      repeat: true\n    });\n  };\n\n  this.clearTimeout = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n    const nodejsTimer = listOfActiveTimers.get(handle);\n\n    if (nodejsTimer) {\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  this.clearInterval = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n    const nodejsTimer = listOfActiveTimers.get(handle);\n\n    if (nodejsTimer) {\n      // We use setTimeout() in timerInitializationSteps even for this.setInterval().\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  function timerInitializationSteps(handler, timeout, args, {\n    methodContext,\n    repeat,\n    previousHandle\n  }) {\n    // This appears to be unspecced, but matches browser behavior for close()ed windows.\n    if (!methodContext._document) {\n      return 0;\n    } // TODO: implement timer nesting level behavior.\n\n\n    const methodContextProxy = methodContext._globalProxy;\n    const handle = previousHandle !== undefined ? previousHandle : ++latestTimerId;\n\n    function task() {\n      if (!listOfActiveTimers.has(handle)) {\n        return;\n      }\n\n      try {\n        if (typeof handler === \"function\") {\n          handler.apply(methodContextProxy, args);\n        } else if (window._runScripts === \"dangerously\") {\n          vm.runInContext(handler, window, {\n            filename: window.location.href,\n            displayErrors: false\n          });\n        }\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n\n      if (listOfActiveTimers.has(handle)) {\n        if (repeat) {\n          timerInitializationSteps(handler, timeout, args, {\n            methodContext,\n            repeat: true,\n            previousHandle: handle\n          });\n        } else {\n          listOfActiveTimers.delete(handle);\n        }\n      }\n    }\n\n    if (timeout < 0) {\n      timeout = 0;\n    }\n\n    const nodejsTimer = setTimeout(task, timeout);\n    listOfActiveTimers.set(handle, nodejsTimer);\n    return handle;\n  } // https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames\n\n\n  let animationFrameCallbackId = 0;\n  const mapOfAnimationFrameCallbacks = new Map();\n  let animationFrameNodejsInterval = null; // Unlike the spec, where an animation frame happens every 60 Hz regardless, we optimize so that if there are no\n  // requestAnimationFrame() calls outstanding, we don't fire the timer. This helps us track that.\n\n  let numberOfOngoingAnimationFrameCallbacks = 0;\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = function (callback) {\n      callback = webIDLConversions.Function(callback);\n      const handle = ++animationFrameCallbackId;\n      mapOfAnimationFrameCallbacks.set(handle, callback);\n      ++numberOfOngoingAnimationFrameCallbacks;\n\n      if (numberOfOngoingAnimationFrameCallbacks === 1) {\n        animationFrameNodejsInterval = setInterval(() => {\n          runAnimationFrameCallbacks(rawPerformance.now() - windowInitialized);\n        }, 1000 / 60);\n      }\n\n      return handle;\n    };\n\n    this.cancelAnimationFrame = function (handle) {\n      handle = webIDLConversions[\"unsigned long\"](handle);\n      removeAnimationFrameCallback(handle);\n    };\n\n    function runAnimationFrameCallbacks(now) {\n      // Converting to an array is important to get a sync snapshot and thus match spec semantics.\n      const callbackHandles = [...mapOfAnimationFrameCallbacks.keys()];\n\n      for (const handle of callbackHandles) {\n        // This has() can be false if a callback calls cancelAnimationFrame().\n        if (mapOfAnimationFrameCallbacks.has(handle)) {\n          const callback = mapOfAnimationFrameCallbacks.get(handle);\n          removeAnimationFrameCallback(handle);\n\n          try {\n            callback(now);\n          } catch (e) {\n            reportException(window, e, window.location.href);\n          }\n        }\n      }\n    }\n\n    function removeAnimationFrameCallback(handle) {\n      if (mapOfAnimationFrameCallbacks.has(handle)) {\n        --numberOfOngoingAnimationFrameCallbacks;\n\n        if (numberOfOngoingAnimationFrameCallbacks === 0) {\n          clearInterval(animationFrameNodejsInterval);\n        }\n      }\n\n      mapOfAnimationFrameCallbacks.delete(handle);\n    }\n  }\n\n  function stopAllTimers() {\n    for (const nodejsTimer of listOfActiveTimers.values()) {\n      clearTimeout(nodejsTimer);\n    }\n\n    listOfActiveTimers.clear();\n    clearInterval(animationFrameNodejsInterval);\n  }\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n\n    impl._selectedness = selected;\n    return option;\n  }\n\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image() {\n    const img = window._document.createElement(\"img\");\n\n    const impl = idlUtils.implForWrapper(img);\n\n    if (arguments.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(arguments[0]));\n    }\n\n    if (arguments.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(arguments[1]));\n    }\n\n    return img;\n  }\n\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n  this.postMessage = postMessage(window);\n\n  this.atob = function (str) {\n    const result = atob(str);\n\n    if (result === null) {\n      throw DOMException.create(window, [\"The string to be decoded contains invalid characters.\", \"InvalidCharacterError\"]);\n    }\n\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n\n    if (result === null) {\n      throw DOMException.create(window, [\"The string to be encoded contains invalid characters.\", \"InvalidCharacterError\"]);\n    }\n\n    return result;\n  };\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves (depth-first).\n    for (let i = 0; i < this.length; ++i) {\n      this[i].close();\n    } // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n\n\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n\n        this._document.close();\n      }\n\n      const doc = idlUtils.implForWrapper(this._document);\n\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n\n      delete this._document;\n    }\n\n    stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt) {\n    elt = Element.convert(elt);\n    let pseudoElt = arguments[1];\n\n    if (pseudoElt !== undefined && pseudoElt !== null) {\n      pseudoElt = webIDLConversions.DOMString(pseudoElt);\n    }\n\n    if (pseudoElt !== undefined && pseudoElt !== null && pseudoElt !== \"\") {\n      // TODO: Parse pseudoElt\n      if (SHADOW_DOM_PSEUDO_REGEXP.test(pseudoElt)) {\n        throw new TypeError(\"Tried to get the computed style of a Shadow DOM pseudo-element.\");\n      }\n\n      notImplemented(\"window.computedStyle(elt, pseudoElt)\", this);\n    }\n\n    const declaration = new CSSStyleDeclaration();\n    const {\n      forEach\n    } = Array.prototype;\n    const {\n      style\n    } = elt;\n    forEachMatchingSheetRuleOfElement(elt, rule => {\n      forEach.call(rule.style, property => {\n        declaration.setProperty(property, rule.style.getPropertyValue(property), rule.style.getPropertyPriority(property));\n      });\n    }); // https://drafts.csswg.org/cssom/#dom-window-getcomputedstyle\n\n    const declarations = Object.keys(propertiesWithResolvedValueImplemented);\n    forEach.call(declarations, property => {\n      declaration.setProperty(property, getResolvedValue(elt, property));\n    });\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n    return declaration;\n  };\n\n  this.getSelection = function () {\n    return window._document.getSelection();\n  }; // The captureEvents() and releaseEvents() methods must do nothing\n\n\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {}; ///// PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeLog: wrapConsoleMethod(\"timeLog\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  }); ///// INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, window.document);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, window.document);\n\n        if (!idlUtils.implForWrapper(window._document)._pageShowingFlag) {\n          idlUtils.implForWrapper(window._document)._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, {\n            persisted: false\n          }, window.document);\n        }\n      });\n    }\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n}","map":{"version":3,"sources":["/Library/WebServer/Documents/capstone/capstone-project-re-coder/node_modules/jsdom/lib/jsdom/browser/Window.js"],"names":["vm","require","webIDLConversions","CSSStyleDeclaration","Performance","RawPerformance","notImplemented","installInterfaces","define","mixin","Element","EventTarget","PageTransitionEvent","namedPropertiesWindow","postMessage","DOMException","btoa","atob","idlUtils","WebSocketImpl","implementation","BarProp","documents","External","Navigator","Screen","Storage","Selection","reportException","fireAnEvent","SessionHistory","forEachMatchingSheetRuleOfElement","getResolvedValue","propertiesWithResolvedValueImplemented","SHADOW_DOM_PSEUDO_REGEXP","CustomElementRegistry","jsGlobals","GlobalEventHandlersImpl","WindowEventHandlersImpl","exports","createWindow","options","Window","jsGlobalEntriesToInstall","Object","entries","filter","name","global","setupWindow","windowInstance","runScripts","contextifyWindow","globalName","globalPropDesc","propDesc","value","runInContext","defineProperty","EventTargetConstructor","windowConstructor","TypeError","setPrototypeOf","configurable","writable","windowPrototype","create","prototype","defineProperties","constructor","Symbol","toStringTag","setup","_initGlobalEvents","_globalObject","rawPerformance","windowInitialized","now","window","_resourceLoader","resourceLoader","_globalProxy","implForWrapper","wrapperSymbol","get","_document","createWrapper","parsingMode","contentType","encoding","cookieJar","url","lastModified","referrer","concurrentNodeIterators","parseOptions","defaultView","alwaysUseDocumentClass","isContext","documentImpl","_defaultView","documentOrigin","_origin","_sessionHistory","document","_URL","stateObject","_virtualConsole","virtualConsole","_runScripts","_parent","_top","_frameElement","_length","_pretendToBeVisual","pretendToBeVisual","_storageQuota","storageQuota","commonForOrigin","_commonForOrigin","localStorageArea","Map","sessionStorageArea","windowsInSameOrigin","_currentOriginData","_localStorage","associatedWindow","storageArea","type","documentURI","_sessionStorage","_selection","createImpl","getSelection","locationbar","menubar","personalbar","scrollbars","statusbar","toolbar","external","navigator","userAgent","_userAgent","performance","screen","customElementRegistry","length","frameElement","wrapperForImpl","frames","self","parent","top","location","_location","history","_history","origin","enumerable","localStorage","sessionStorage","customElements","initializeWindow","listOfActiveTimers","latestTimerId","setTimeout","handler","timeout","args","DOMString","long","timerInitializationSteps","methodContext","repeat","setInterval","clearTimeout","handle","nodejsTimer","delete","clearInterval","previousHandle","methodContextProxy","undefined","task","has","apply","filename","href","displayErrors","e","set","animationFrameCallbackId","mapOfAnimationFrameCallbacks","animationFrameNodejsInterval","numberOfOngoingAnimationFrameCallbacks","requestAnimationFrame","callback","Function","runAnimationFrameCallbacks","cancelAnimationFrame","removeAnimationFrameCallback","callbackHandles","keys","stopAllTimers","values","clear","Option","text","defaultSelected","selected","boolean","option","createElement","impl","setAttributeNS","_selectedness","HTMLOptionElement","Image","img","arguments","String","HTMLImageElement","Audio","src","audio","HTMLAudioElement","str","result","stop","manager","_requestManager","close","i","_eventListeners","body","innerHTML","doc","cleanUpWindow","getComputedStyle","elt","convert","pseudoElt","test","declaration","forEach","Array","style","rule","call","property","setProperty","getPropertyValue","getPropertyPriority","declarations","captureEvents","releaseEvents","wrapConsoleMethod","method","emit","console","assert","count","countReset","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","table","time","timeLog","timeEnd","trace","warn","notImplementedMethod","status","devicePixelRatio","innerWidth","innerHeight","outerWidth","outerHeight","pageXOffset","pageYOffset","screenX","screenLeft","screenY","screenTop","scrollX","scrollY","alert","blur","confirm","focus","moveBy","moveTo","open","print","prompt","resizeBy","resizeTo","scroll","scrollBy","scrollTo","process","nextTick","readyState","addEventListener","_pageShowingFlag","persisted","createContext"],"mappings":"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","sourcesContent":["\"use strict\";\nconst vm = require(\"vm\");\nconst webIDLConversions = require(\"webidl-conversions\");\nconst { CSSStyleDeclaration } = require(\"cssstyle\");\nconst { Performance: RawPerformance } = require(\"w3c-hr-time\");\nconst notImplemented = require(\"./not-implemented\");\nconst { installInterfaces } = require(\"../living/interfaces\");\nconst { define, mixin } = require(\"../utils\");\nconst Element = require(\"../living/generated/Element\");\nconst EventTarget = require(\"../living/generated/EventTarget\");\nconst PageTransitionEvent = require(\"../living/generated/PageTransitionEvent\");\nconst namedPropertiesWindow = require(\"../living/named-properties-window\");\nconst postMessage = require(\"../living/post-message\");\nconst DOMException = require(\"domexception/webidl2js-wrapper\");\nconst { btoa, atob } = require(\"abab\");\nconst idlUtils = require(\"../living/generated/utils\");\nconst WebSocketImpl = require(\"../living/websockets/WebSocket-impl\").implementation;\nconst BarProp = require(\"../living/generated/BarProp\");\nconst documents = require(\"../living/documents.js\");\nconst External = require(\"../living/generated/External\");\nconst Navigator = require(\"../living/generated/Navigator\");\nconst Performance = require(\"../living/generated/Performance\");\nconst Screen = require(\"../living/generated/Screen\");\nconst Storage = require(\"../living/generated/Storage\");\nconst Selection = require(\"../living/generated/Selection\");\nconst reportException = require(\"../living/helpers/runtime-script-errors\");\nconst { fireAnEvent } = require(\"../living/helpers/events\");\nconst SessionHistory = require(\"../living/window/SessionHistory\");\nconst { forEachMatchingSheetRuleOfElement, getResolvedValue, propertiesWithResolvedValueImplemented,\n  SHADOW_DOM_PSEUDO_REGEXP } = require(\"../living/helpers/style-rules.js\");\nconst CustomElementRegistry = require(\"../living/generated/CustomElementRegistry\");\nconst jsGlobals = require(\"./js-globals.json\");\n\nconst GlobalEventHandlersImpl = require(\"../living/nodes/GlobalEventHandlers-impl\").implementation;\nconst WindowEventHandlersImpl = require(\"../living/nodes/WindowEventHandlers-impl\").implementation;\n\nexports.createWindow = function (options) {\n  return new Window(options);\n};\n\nconst jsGlobalEntriesToInstall = Object.entries(jsGlobals).filter(([name]) => name in global);\n\n// https://html.spec.whatwg.org/#the-window-object\nfunction setupWindow(windowInstance, { runScripts }) {\n  if (runScripts === \"outside-only\" || runScripts === \"dangerously\") {\n    contextifyWindow(windowInstance);\n\n    // Without this, these globals will only appear to scripts running inside the context using vm.runScript; they will\n    // not appear to scripts running from the outside, including to JSDOM implementation code.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc, value: vm.runInContext(globalName, windowInstance) };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  } else {\n    // Without contextifying the window, none of the globals will exist. So, let's at least alias them from the Node.js\n    // context. See https://github.com/jsdom/jsdom/issues/2727 for more background and discussion.\n    for (const [globalName, globalPropDesc] of jsGlobalEntriesToInstall) {\n      const propDesc = { ...globalPropDesc, value: global[globalName] };\n      Object.defineProperty(windowInstance, globalName, propDesc);\n    }\n  }\n\n  installInterfaces(windowInstance, [\"Window\"]);\n\n  const EventTargetConstructor = windowInstance.EventTarget;\n\n  // eslint-disable-next-line func-name-matching, func-style, no-shadow\n  const windowConstructor = function Window() {\n    throw new TypeError(\"Illegal constructor\");\n  };\n  Object.setPrototypeOf(windowConstructor, EventTargetConstructor);\n\n  Object.defineProperty(windowInstance, \"Window\", {\n    configurable: true,\n    writable: true,\n    value: windowConstructor\n  });\n\n  const windowPrototype = Object.create(EventTargetConstructor.prototype);\n  Object.defineProperties(windowPrototype, {\n    constructor: {\n      value: windowConstructor,\n      writable: true,\n      configurable: true\n    },\n    [Symbol.toStringTag]: {\n      value: \"Window\",\n      configurable: true\n    }\n  });\n\n  windowConstructor.prototype = windowPrototype;\n  Object.setPrototypeOf(windowInstance, windowPrototype);\n\n  EventTarget.setup(windowInstance, windowInstance);\n  mixin(windowInstance, WindowEventHandlersImpl.prototype);\n  mixin(windowInstance, GlobalEventHandlersImpl.prototype);\n  windowInstance._initGlobalEvents();\n\n  windowInstance._globalObject = windowInstance;\n}\n\n// NOTE: per https://heycam.github.io/webidl/#Global, all properties on the Window object must be own-properties.\n// That is why we assign everything inside of the constructor, instead of using a shared prototype.\n// You can verify this in e.g. Firefox or Internet Explorer, which do a good job with Web IDL compliance.\nfunction Window(options) {\n  setupWindow(this, { runScripts: options.runScripts });\n\n  const rawPerformance = new RawPerformance();\n  const windowInitialized = rawPerformance.now();\n\n  const window = this;\n\n  ///// PRIVATE DATA PROPERTIES\n\n  this._resourceLoader = options.resourceLoader;\n\n  // vm initialization is deferred until script processing is activated\n  this._globalProxy = this;\n  Object.defineProperty(idlUtils.implForWrapper(this), idlUtils.wrapperSymbol, { get: () => this._globalProxy });\n\n  // List options explicitly to be clear which are passed through\n  this._document = documents.createWrapper(window, {\n    parsingMode: options.parsingMode,\n    contentType: options.contentType,\n    encoding: options.encoding,\n    cookieJar: options.cookieJar,\n    url: options.url,\n    lastModified: options.lastModified,\n    referrer: options.referrer,\n    concurrentNodeIterators: options.concurrentNodeIterators,\n    parseOptions: options.parseOptions,\n    defaultView: this._globalProxy,\n    global: this\n  }, { alwaysUseDocumentClass: true });\n\n  if (vm.isContext(window)) {\n    const documentImpl = idlUtils.implForWrapper(window._document);\n    documentImpl._defaultView = window._globalProxy = vm.runInContext(\"this\", window);\n  }\n\n  const documentOrigin = idlUtils.implForWrapper(this._document)._origin;\n  this._origin = documentOrigin;\n\n  // https://html.spec.whatwg.org/#session-history\n  this._sessionHistory = new SessionHistory({\n    document: idlUtils.implForWrapper(this._document),\n    url: idlUtils.implForWrapper(this._document)._URL,\n    stateObject: null\n  }, this);\n\n  this._virtualConsole = options.virtualConsole;\n\n  this._runScripts = options.runScripts;\n\n  // Set up the window as if it's a top level window.\n  // If it's not, then references will be corrected by frame/iframe code.\n  this._parent = this._top = this._globalProxy;\n  this._frameElement = null;\n\n  // This implements window.frames.length, since window.frames returns a\n  // self reference to the window object.  This value is incremented in the\n  // HTMLFrameElement implementation.\n  this._length = 0;\n\n  this._pretendToBeVisual = options.pretendToBeVisual;\n  this._storageQuota = options.storageQuota;\n\n  // Some properties (such as localStorage and sessionStorage) share data\n  // between windows in the same origin. This object is intended\n  // to contain such data.\n  if (options.commonForOrigin && options.commonForOrigin[documentOrigin]) {\n    this._commonForOrigin = options.commonForOrigin;\n  } else {\n    this._commonForOrigin = {\n      [documentOrigin]: {\n        localStorageArea: new Map(),\n        sessionStorageArea: new Map(),\n        windowsInSameOrigin: [this]\n      }\n    };\n  }\n\n  this._currentOriginData = this._commonForOrigin[documentOrigin];\n\n  ///// WEB STORAGE\n\n  this._localStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.localStorageArea,\n    type: \"localStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n  this._sessionStorage = Storage.create(window, [], {\n    associatedWindow: this,\n    storageArea: this._currentOriginData.sessionStorageArea,\n    type: \"sessionStorage\",\n    url: this._document.documentURI,\n    storageQuota: this._storageQuota\n  });\n\n  ///// SELECTION\n\n  // https://w3c.github.io/selection-api/#dfn-selection\n  this._selection = Selection.createImpl(window);\n\n  // https://w3c.github.io/selection-api/#dom-window\n  this.getSelection = function () {\n    return window._selection;\n  };\n\n  ///// GETTERS\n\n  const locationbar = BarProp.create(window);\n  const menubar = BarProp.create(window);\n  const personalbar = BarProp.create(window);\n  const scrollbars = BarProp.create(window);\n  const statusbar = BarProp.create(window);\n  const toolbar = BarProp.create(window);\n  const external = External.create(window);\n  const navigator = Navigator.create(window, [], { userAgent: this._resourceLoader._userAgent });\n  const performance = Performance.create(window, [], { rawPerformance });\n  const screen = Screen.create(window);\n  const customElementRegistry = CustomElementRegistry.create(window);\n\n  define(this, {\n    get length() {\n      return window._length;\n    },\n    get window() {\n      return window._globalProxy;\n    },\n    get frameElement() {\n      return idlUtils.wrapperForImpl(window._frameElement);\n    },\n    get frames() {\n      return window._globalProxy;\n    },\n    get self() {\n      return window._globalProxy;\n    },\n    get parent() {\n      return window._parent;\n    },\n    get top() {\n      return window._top;\n    },\n    get document() {\n      return window._document;\n    },\n    get external() {\n      return external;\n    },\n    get location() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._location);\n    },\n    get history() {\n      return idlUtils.wrapperForImpl(idlUtils.implForWrapper(window._document)._history);\n    },\n    get navigator() {\n      return navigator;\n    },\n    get locationbar() {\n      return locationbar;\n    },\n    get menubar() {\n      return menubar;\n    },\n    get personalbar() {\n      return personalbar;\n    },\n    get scrollbars() {\n      return scrollbars;\n    },\n    get statusbar() {\n      return statusbar;\n    },\n    get toolbar() {\n      return toolbar;\n    },\n    get performance() {\n      return performance;\n    },\n    get screen() {\n      return screen;\n    },\n    get origin() {\n      return window._origin;\n    },\n    // The origin IDL attribute is defined with [Replaceable].\n    set origin(value) {\n      Object.defineProperty(this, \"origin\", {\n        value,\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n    },\n    get localStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\n          \"localStorage is not available for opaque origins\",\n          \"SecurityError\"\n        ]);\n      }\n\n      return this._localStorage;\n    },\n    get sessionStorage() {\n      if (idlUtils.implForWrapper(this._document)._origin === \"null\") {\n        throw DOMException.create(window, [\n          \"sessionStorage is not available for opaque origins\",\n          \"SecurityError\"\n        ]);\n      }\n\n      return this._sessionStorage;\n    },\n    get customElements() {\n      return customElementRegistry;\n    }\n  });\n\n  namedPropertiesWindow.initializeWindow(this, this._globalProxy);\n\n  ///// METHODS\n\n  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#timers\n\n  // In the spec the list of active timers is a set of IDs. We make it a map of IDs to Node.js timer objects, so that\n  // we can call Node.js-side clearTimeout() when clearing, and thus allow process shutdown faster.\n  const listOfActiveTimers = new Map();\n  let latestTimerId = 0;\n\n  this.setTimeout = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n    timeout = webIDLConversions.long(timeout);\n\n    return timerInitializationSteps(handler, timeout, args, { methodContext: window, repeat: false });\n  };\n  this.setInterval = function (handler, timeout = 0, ...args) {\n    if (typeof handler !== \"function\") {\n      handler = webIDLConversions.DOMString(handler);\n    }\n    timeout = webIDLConversions.long(timeout);\n\n    return timerInitializationSteps(handler, timeout, args, { methodContext: window, repeat: true });\n  };\n\n  this.clearTimeout = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n\n    const nodejsTimer = listOfActiveTimers.get(handle);\n    if (nodejsTimer) {\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n  this.clearInterval = function (handle = 0) {\n    handle = webIDLConversions.long(handle);\n\n    const nodejsTimer = listOfActiveTimers.get(handle);\n    if (nodejsTimer) {\n      // We use setTimeout() in timerInitializationSteps even for this.setInterval().\n      clearTimeout(nodejsTimer);\n      listOfActiveTimers.delete(handle);\n    }\n  };\n\n  function timerInitializationSteps(handler, timeout, args, { methodContext, repeat, previousHandle }) {\n    // This appears to be unspecced, but matches browser behavior for close()ed windows.\n    if (!methodContext._document) {\n      return 0;\n    }\n\n    // TODO: implement timer nesting level behavior.\n\n    const methodContextProxy = methodContext._globalProxy;\n    const handle = previousHandle !== undefined ? previousHandle : ++latestTimerId;\n\n    function task() {\n      if (!listOfActiveTimers.has(handle)) {\n        return;\n      }\n\n      try {\n        if (typeof handler === \"function\") {\n          handler.apply(methodContextProxy, args);\n        } else if (window._runScripts === \"dangerously\") {\n          vm.runInContext(handler, window, { filename: window.location.href, displayErrors: false });\n        }\n      } catch (e) {\n        reportException(window, e, window.location.href);\n      }\n\n      if (listOfActiveTimers.has(handle)) {\n        if (repeat) {\n          timerInitializationSteps(handler, timeout, args, { methodContext, repeat: true, previousHandle: handle });\n        } else {\n          listOfActiveTimers.delete(handle);\n        }\n      }\n    }\n\n    if (timeout < 0) {\n      timeout = 0;\n    }\n\n    const nodejsTimer = setTimeout(task, timeout);\n    listOfActiveTimers.set(handle, nodejsTimer);\n\n    return handle;\n  }\n\n  // https://html.spec.whatwg.org/multipage/imagebitmap-and-animations.html#animation-frames\n\n  let animationFrameCallbackId = 0;\n  const mapOfAnimationFrameCallbacks = new Map();\n  let animationFrameNodejsInterval = null;\n\n  // Unlike the spec, where an animation frame happens every 60 Hz regardless, we optimize so that if there are no\n  // requestAnimationFrame() calls outstanding, we don't fire the timer. This helps us track that.\n  let numberOfOngoingAnimationFrameCallbacks = 0;\n\n  if (this._pretendToBeVisual) {\n    this.requestAnimationFrame = function (callback) {\n      callback = webIDLConversions.Function(callback);\n\n      const handle = ++animationFrameCallbackId;\n      mapOfAnimationFrameCallbacks.set(handle, callback);\n\n      ++numberOfOngoingAnimationFrameCallbacks;\n      if (numberOfOngoingAnimationFrameCallbacks === 1) {\n        animationFrameNodejsInterval = setInterval(() => {\n          runAnimationFrameCallbacks(rawPerformance.now() - windowInitialized);\n        }, 1000 / 60);\n      }\n\n      return handle;\n    };\n\n    this.cancelAnimationFrame = function (handle) {\n      handle = webIDLConversions[\"unsigned long\"](handle);\n\n      removeAnimationFrameCallback(handle);\n    };\n\n    function runAnimationFrameCallbacks(now) {\n      // Converting to an array is important to get a sync snapshot and thus match spec semantics.\n      const callbackHandles = [...mapOfAnimationFrameCallbacks.keys()];\n      for (const handle of callbackHandles) {\n        // This has() can be false if a callback calls cancelAnimationFrame().\n        if (mapOfAnimationFrameCallbacks.has(handle)) {\n          const callback = mapOfAnimationFrameCallbacks.get(handle);\n          removeAnimationFrameCallback(handle);\n          try {\n            callback(now);\n          } catch (e) {\n            reportException(window, e, window.location.href);\n          }\n        }\n      }\n    }\n\n    function removeAnimationFrameCallback(handle) {\n      if (mapOfAnimationFrameCallbacks.has(handle)) {\n        --numberOfOngoingAnimationFrameCallbacks;\n        if (numberOfOngoingAnimationFrameCallbacks === 0) {\n          clearInterval(animationFrameNodejsInterval);\n        }\n      }\n\n      mapOfAnimationFrameCallbacks.delete(handle);\n    }\n  }\n\n  function stopAllTimers() {\n    for (const nodejsTimer of listOfActiveTimers.values()) {\n      clearTimeout(nodejsTimer);\n    }\n    listOfActiveTimers.clear();\n\n    clearInterval(animationFrameNodejsInterval);\n  }\n\n  function Option(text, value, defaultSelected, selected) {\n    if (text === undefined) {\n      text = \"\";\n    }\n    text = webIDLConversions.DOMString(text);\n\n    if (value !== undefined) {\n      value = webIDLConversions.DOMString(value);\n    }\n\n    defaultSelected = webIDLConversions.boolean(defaultSelected);\n    selected = webIDLConversions.boolean(selected);\n\n    const option = window._document.createElement(\"option\");\n    const impl = idlUtils.implForWrapper(option);\n\n    if (text !== \"\") {\n      impl.text = text;\n    }\n    if (value !== undefined) {\n      impl.setAttributeNS(null, \"value\", value);\n    }\n    if (defaultSelected) {\n      impl.setAttributeNS(null, \"selected\", \"\");\n    }\n    impl._selectedness = selected;\n\n    return option;\n  }\n  Object.defineProperty(Option, \"prototype\", {\n    value: this.HTMLOptionElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Option\", {\n    value: Option,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Image() {\n    const img = window._document.createElement(\"img\");\n    const impl = idlUtils.implForWrapper(img);\n\n    if (arguments.length > 0) {\n      impl.setAttributeNS(null, \"width\", String(arguments[0]));\n    }\n    if (arguments.length > 1) {\n      impl.setAttributeNS(null, \"height\", String(arguments[1]));\n    }\n\n    return img;\n  }\n  Object.defineProperty(Image, \"prototype\", {\n    value: this.HTMLImageElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Image\", {\n    value: Image,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  function Audio(src) {\n    const audio = window._document.createElement(\"audio\");\n    const impl = idlUtils.implForWrapper(audio);\n    impl.setAttributeNS(null, \"preload\", \"auto\");\n\n    if (src !== undefined) {\n      impl.setAttributeNS(null, \"src\", String(src));\n    }\n\n    return audio;\n  }\n  Object.defineProperty(Audio, \"prototype\", {\n    value: this.HTMLAudioElement.prototype,\n    configurable: false,\n    enumerable: false,\n    writable: false\n  });\n  Object.defineProperty(window, \"Audio\", {\n    value: Audio,\n    configurable: true,\n    enumerable: false,\n    writable: true\n  });\n\n  this.postMessage = postMessage(window);\n\n  this.atob = function (str) {\n    const result = atob(str);\n    if (result === null) {\n      throw DOMException.create(window, [\n        \"The string to be decoded contains invalid characters.\",\n        \"InvalidCharacterError\"\n      ]);\n    }\n    return result;\n  };\n\n  this.btoa = function (str) {\n    const result = btoa(str);\n    if (result === null) {\n      throw DOMException.create(window, [\n        \"The string to be encoded contains invalid characters.\",\n        \"InvalidCharacterError\"\n      ]);\n    }\n    return result;\n  };\n\n  this.stop = function () {\n    const manager = idlUtils.implForWrapper(this._document)._requestManager;\n    if (manager) {\n      manager.close();\n    }\n  };\n\n  this.close = function () {\n    // Recursively close child frame windows, then ourselves (depth-first).\n    for (let i = 0; i < this.length; ++i) {\n      this[i].close();\n    }\n\n    // Clear out all listeners. Any in-flight or upcoming events should not get delivered.\n    idlUtils.implForWrapper(this)._eventListeners = Object.create(null);\n\n    if (this._document) {\n      if (this._document.body) {\n        this._document.body.innerHTML = \"\";\n      }\n\n      if (this._document.close) {\n        // It's especially important to clear out the listeners here because document.close() causes a \"load\" event to\n        // fire.\n        idlUtils.implForWrapper(this._document)._eventListeners = Object.create(null);\n        this._document.close();\n      }\n      const doc = idlUtils.implForWrapper(this._document);\n      if (doc._requestManager) {\n        doc._requestManager.close();\n      }\n      delete this._document;\n    }\n\n    stopAllTimers();\n    WebSocketImpl.cleanUpWindow(this);\n  };\n\n  this.getComputedStyle = function (elt) {\n    elt = Element.convert(elt);\n    let pseudoElt = arguments[1];\n    if (pseudoElt !== undefined && pseudoElt !== null) {\n      pseudoElt = webIDLConversions.DOMString(pseudoElt);\n    }\n\n    if (pseudoElt !== undefined && pseudoElt !== null && pseudoElt !== \"\") {\n      // TODO: Parse pseudoElt\n\n      if (SHADOW_DOM_PSEUDO_REGEXP.test(pseudoElt)) {\n        throw new TypeError(\"Tried to get the computed style of a Shadow DOM pseudo-element.\");\n      }\n\n      notImplemented(\"window.computedStyle(elt, pseudoElt)\", this);\n    }\n\n    const declaration = new CSSStyleDeclaration();\n    const { forEach } = Array.prototype;\n    const { style } = elt;\n\n    forEachMatchingSheetRuleOfElement(elt, rule => {\n      forEach.call(rule.style, property => {\n        declaration.setProperty(\n          property,\n          rule.style.getPropertyValue(property),\n          rule.style.getPropertyPriority(property)\n        );\n      });\n    });\n\n    // https://drafts.csswg.org/cssom/#dom-window-getcomputedstyle\n    const declarations = Object.keys(propertiesWithResolvedValueImplemented);\n    forEach.call(declarations, property => {\n      declaration.setProperty(property, getResolvedValue(elt, property));\n    });\n\n    forEach.call(style, property => {\n      declaration.setProperty(property, style.getPropertyValue(property), style.getPropertyPriority(property));\n    });\n\n    return declaration;\n  };\n\n  this.getSelection = function () {\n    return window._document.getSelection();\n  };\n\n  // The captureEvents() and releaseEvents() methods must do nothing\n  this.captureEvents = function () {};\n\n  this.releaseEvents = function () {};\n\n  ///// PUBLIC DATA PROPERTIES (TODO: should be getters)\n\n  function wrapConsoleMethod(method) {\n    return (...args) => {\n      window._virtualConsole.emit(method, ...args);\n    };\n  }\n\n  this.console = {\n    assert: wrapConsoleMethod(\"assert\"),\n    clear: wrapConsoleMethod(\"clear\"),\n    count: wrapConsoleMethod(\"count\"),\n    countReset: wrapConsoleMethod(\"countReset\"),\n    debug: wrapConsoleMethod(\"debug\"),\n    dir: wrapConsoleMethod(\"dir\"),\n    dirxml: wrapConsoleMethod(\"dirxml\"),\n    error: wrapConsoleMethod(\"error\"),\n    group: wrapConsoleMethod(\"group\"),\n    groupCollapsed: wrapConsoleMethod(\"groupCollapsed\"),\n    groupEnd: wrapConsoleMethod(\"groupEnd\"),\n    info: wrapConsoleMethod(\"info\"),\n    log: wrapConsoleMethod(\"log\"),\n    table: wrapConsoleMethod(\"table\"),\n    time: wrapConsoleMethod(\"time\"),\n    timeLog: wrapConsoleMethod(\"timeLog\"),\n    timeEnd: wrapConsoleMethod(\"timeEnd\"),\n    trace: wrapConsoleMethod(\"trace\"),\n    warn: wrapConsoleMethod(\"warn\")\n  };\n\n  function notImplementedMethod(name) {\n    return function () {\n      notImplemented(name, window);\n    };\n  }\n\n  define(this, {\n    name: \"\",\n    status: \"\",\n    devicePixelRatio: 1,\n    innerWidth: 1024,\n    innerHeight: 768,\n    outerWidth: 1024,\n    outerHeight: 768,\n    pageXOffset: 0,\n    pageYOffset: 0,\n    screenX: 0,\n    screenLeft: 0,\n    screenY: 0,\n    screenTop: 0,\n    scrollX: 0,\n    scrollY: 0,\n\n    alert: notImplementedMethod(\"window.alert\"),\n    blur: notImplementedMethod(\"window.blur\"),\n    confirm: notImplementedMethod(\"window.confirm\"),\n    focus: notImplementedMethod(\"window.focus\"),\n    moveBy: notImplementedMethod(\"window.moveBy\"),\n    moveTo: notImplementedMethod(\"window.moveTo\"),\n    open: notImplementedMethod(\"window.open\"),\n    print: notImplementedMethod(\"window.print\"),\n    prompt: notImplementedMethod(\"window.prompt\"),\n    resizeBy: notImplementedMethod(\"window.resizeBy\"),\n    resizeTo: notImplementedMethod(\"window.resizeTo\"),\n    scroll: notImplementedMethod(\"window.scroll\"),\n    scrollBy: notImplementedMethod(\"window.scrollBy\"),\n    scrollTo: notImplementedMethod(\"window.scrollTo\")\n  });\n\n  ///// INITIALIZATION\n\n  process.nextTick(() => {\n    if (!window.document) {\n      return; // window might've been closed already\n    }\n\n    if (window.document.readyState === \"complete\") {\n      fireAnEvent(\"load\", window, undefined, {}, window.document);\n    } else {\n      window.document.addEventListener(\"load\", () => {\n        fireAnEvent(\"load\", window, undefined, {}, window.document);\n\n        if (!idlUtils.implForWrapper(window._document)._pageShowingFlag) {\n          idlUtils.implForWrapper(window._document)._pageShowingFlag = true;\n          fireAnEvent(\"pageshow\", window, PageTransitionEvent, { persisted: false }, window.document);\n        }\n      });\n    }\n  });\n}\n\nfunction contextifyWindow(window) {\n  if (vm.isContext(window)) {\n    return;\n  }\n\n  vm.createContext(window);\n}\n"]},"metadata":{},"sourceType":"script"}